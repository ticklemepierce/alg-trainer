import{f as I,g as k}from"./chunk-JWTZDVRE.js";import"./chunk-F76XKWKJ.js";var ft=class{constructor(t,e){this.facenames=t,this.prefixFree=!0,this.gripnames=[],e&&(this.gripnames=e);for(let s=0;this.prefixFree&&s<t.length;s++)for(let i=0;this.prefixFree&&i<t.length;i++)s!==i&&t[s].startsWith(t[i])&&(this.prefixFree=!1)}setGripNames(t){this.gripnames=t}splitByFaceNames(t){let e=[],s=0;for(;s<t.length;){s>0&&s<t.length&&t[s]==="_"&&s++;let i=-1;for(let n=0;n<this.facenames.length;n++)t.substr(s).startsWith(this.facenames[n])&&(i<0||this.facenames[n].length>this.facenames[i].length)&&(i=n);if(i>=0)e.push(i),s+=this.facenames[i].length;else throw new Error(`Could not split ${t} into face names.`)}return e}joinByFaceIndices(t){let e="",s=[];for(let i=0;i<t.length;i++)s.push(e),s.push(this.facenames[t[i]]),this.prefixFree||(e="_");return s.join("")}spinmatch(t,e){if(t===e)return!0;try{let s=this.splitByFaceNames(t),i=this.splitByFaceNames(e);if(s.length!==i.length&&s.length<3)return!1;for(let n=0;n<s.length;n++){for(let r=0;r<n;r++)if(s[n]===s[r])return!1;let o=!1;for(let r=0;r<i.length;r++)if(s[n]===i[r]){o=!0;break}if(!o)return!1}return!0}catch{return!1}}spinmatchv(t,e){return t.endsWith("v")&&e.endsWith("v")?this.spinmatch(t.slice(0,t.length-1),e.slice(0,e.length-1)):this.spinmatch(t,e)}unswizzle(t){(t.endsWith("v")||t.endsWith("w"))&&t[0]<="Z"&&(t=t.slice(0,t.length-1));let e=t.toUpperCase();for(let s=0;s<this.gripnames.length;s++){let i=this.gripnames[s];if(this.spinmatch(e,i))return i}return t}},$t=class{notationToInternal(t){return t}notationToExternal(t){return t}},Qt=class{constructor(t,e){this.child=t,this.sw=e}notationToInternal(t){return t.family==="T"&&t.innerLayer===void 0&&t.outerLayer===void 0?new k(new I("FLRv",t.innerLayer,t.outerLayer),t.amount):this.child.notationToInternal(t)}notationToExternal(t){let e=t.family;return e.length>0&&e[e.length-1]==="v"&&(e=e.substring(0,e.length-1)),this.sw.spinmatch(e,"FLUR")?new k(new I("T",t.innerLayer,t.outerLayer),t.amount):this.child.notationToExternal(t)}},Mt=class{constructor(t,e){this.internalNames=t,this.externalNames=e}convertString(t,e,s){let i="";(t.endsWith("v")||t.endsWith("v"))&&t<="_"&&(i=t.slice(t.length-1),t=t.slice(0,t.length-1));let n=t.toUpperCase(),o=!1;return t!==n&&(o=!0,t=n),t=s.joinByFaceIndices(e.splitByFaceNames(t)),o&&(t=t.toLowerCase()),t+i}convert(t,e,s){let i=t.family,n=this.convertString(i,e,s);return i===n?t:new k(new I(n,t.innerLayer,t.outerLayer),t.amount)}notationToInternal(t){return this.convert(t,this.externalNames,this.internalNames)}notationToExternal(t){return this.convert(t,this.internalNames,this.externalNames)}},_t=class{constructor(t){this.child=t}notationToInternal(t){if(t.innerLayer===void 0&&t.outerLayer===void 0){if(Math.abs(t.amount)===1){if(t.family==="R++")return new k(new I("L",3,2),-2*t.amount);if(t.family==="R--")return new k(new I("L",3,2),2*t.amount);if(t.family==="D++")return new k(new I("U",3,2),-2*t.amount);if(t.family==="D--")return new k(new I("U",3,2),2*t.amount);if(t.family==="R_PLUSPLUS_")return new k(new I("L",3,2),-2*t.amount);if(t.family==="D_PLUSPLUS_")return new k(new I("U",3,2),-2*t.amount)}if(t.family==="y")return new k("Uv",t.amount);if(t.family==="x"&&Math.abs(t.amount)===2)return new k("ERv",t.amount/2)}return this.child.notationToInternal(t)}notationToExternal(t){return t.family==="ERv"&&Math.abs(t.amount)===1?new k(new I("x",t.innerLayer,t.outerLayer),t.amount*2):t.family==="ILv"&&Math.abs(t.amount)===1?new k(new I("x",t.innerLayer,t.outerLayer),-t.amount*2):t.family==="Uv"?new k(new I("y",t.innerLayer,t.outerLayer),t.amount):t.family==="Dv"?new k("y",-t.amount):this.child.notationToExternal(t)}},Ht=class{constructor(t){this.slices=t}notationToInternal(t){let e=t.family;return t.innerLayer||t.outerLayer||(e==="x"?t=new k("Rv",t.amount):e==="y"?t=new k("Uv",t.amount):e==="z"&&(t=new k("Fv",t.amount)),(this.slices&1)===1&&(e==="E"?t=new k(new I("D",(this.slices+1)/2),t.amount):e==="M"?t=new k(new I("L",(this.slices+1)/2),t.amount):e==="S"&&(t=new k(new I("F",(this.slices+1)/2),t.amount))),this.slices>2&&(e==="e"?t=new k(new I("D",this.slices-1,2),t.amount):e==="m"?t=new k(new I("L",this.slices-1,2),t.amount):e==="s"&&(t=new k(new I("F",this.slices-1,2),t.amount)))),t}notationToExternal(t){let e=t.family;if(!(t.innerLayer||t.outerLayer)){if(e==="Rv")return new k("x",t.amount);if(e==="Uv")return new k("y",t.amount);if(e==="Fv")return new k("z",t.amount);if(e==="Lv")return new k("x",-t.amount);if(e==="Dv")return new k("y",-t.amount);if(e==="Bv")return new k("z",-t.amount)}return t}},Zt={U:"frl",L:"fld",R:"fdr",B:"dlr",u:"FRL",l:"FLD",r:"FDR",b:"DLR",Uv:"FRLv",Lv:"FLDv",Rv:"FDRv",Bv:"DLRv",D:"D",F:"F",BL:"L",BR:"R"},Wt={U:"FRL",L:"FLD",R:"FDR",B:"DLR",u:"frl",l:"fld",r:"fdr",b:"dlr",Uv:"FRLv",Lv:"FLDv",Rv:"FDRv",Bv:"DLRv",D:"D",F:"F",BL:"L",BR:"R",d:"d",f:"f",bl:"l",br:"r"},zt={U:"FRL",L:"FLD",R:"FDR",B:"DLR"},Rt=new I("y"),kt=new I("Dv"),It=class{constructor(t){this.child=t,this.wcaHack=!1,this.map=Zt}notationToInternal(t){if(this.wcaHack&&t.innerLayer===2&&t.outerLayer===null){let s=zt[t.family];if(s)return new k(new I(s,t.innerLayer,t.outerLayer),t.amount)}let e=this.map[t.family];return e?new k(new I(e,t.innerLayer,t.outerLayer),t.amount):Rt.isIdentical(t.quantum)?new k(kt,-t.amount):null}notationToExternal(t){if(this.wcaHack&&t.innerLayer===2&&t.outerLayer===null){for(let[e,s]of Object.entries(zt))if(this.child.spinmatch(t.family,s))return new k(new I(e,t.innerLayer,t.outerLayer),t.amount)}for(let[e,s]of Object.entries(this.map))if(this.child.spinmatch(t.family,s))return new k(new I(e,t.innerLayer,t.outerLayer),t.amount);return kt.isIdentical(t.quantum)?new k(Rt,-t.amount):null}},Jt=class extends It{constructor(t){super(t),this.wcaHack=!0,this.map=Wt}},Dt={U:"UBL",UL:"ULF",F:"UFR",UR:"URB",B:"DBL",D:"DFR",L:"DLF",R:"DRB",Uv:"UBLv",ULv:"ULFv",Fv:"UFRv",URv:"URBv",Bv:"DBLv",Dv:"DFRv",Lv:"DLFv",Rv:"DRBv"},ut=new I("x"),Et=new I("Rv"),Yt=new I("Lv"),pt=new I("y"),jt=new I("Uv"),Vt=new I("Dv"),mt=new I("z"),Ct=new I("Fv"),Xt=new I("Bv"),qt=class{constructor(t){this.child=t}notationToInternal(t){if(t.innerLayer||t.outerLayer)return null;let e=Dt[t.family];return e?new k(new I(e,t.outerLayer,t.innerLayer),t.amount):ut.isIdentical(t.quantum)?new k(Et,t.amount):pt.isIdentical(t.quantum)?new k(jt,t.amount):mt.isIdentical(t.quantum)?new k(Ct,t.amount):null}notationToExternal(t){for(let[e,s]of Object.entries(Dt))if(this.child.spinmatchv(t.family,s))return new k(new I(e,t.innerLayer,t.outerLayer),t.amount);return Et.isIdentical(t.quantum)?new k(ut,t.amount):Yt.isIdentical(t.quantum)?new k(ut,-t.amount):jt.isIdentical(t.quantum)?new k(pt,t.amount):Vt.isIdentical(t.quantum)?new k(pt,-t.amount):Ct.isIdentical(t.quantum)?new k(mt,t.amount):Xt.isIdentical(t.quantum)?new k(mt,-t.amount):null}};function Re(t){let e=0,s={};for(;e<t.length&&t[e][0]==="-";){let n=t[e++];if(n==="--rotations")s.addRotations=!0;else if(n==="--allmoves")s.allMoves=!0;else if(n==="--outerblockmoves")s.outerBlockMoves=!0;else if(n==="--vertexmoves")s.vertexMoves=!0;else if(n==="--nocorners")s.includeCornerOrbits=!1;else if(n==="--noedges")s.includeEdgeOrbits=!1;else if(n==="--noorientation")s.fixedOrientation=!0;else if(n==="--nocenters")s.includeCenterOrbits=!1;else if(n==="--omit")s.excludeOrbits=t[e].split(","),e++;else if(n==="--moves")s.moveList=t[e].split(","),e++;else if(n==="--optimize")s.optimizeOrbits=!0;else if(n==="--scramble")s.scrambleAmount=100;else if(n==="--fixcorner")s.fixedPieceType="v";else if(n==="--fixedge")s.fixedPieceType="e";else if(n==="--fixcenter")s.fixedPieceType="f";else if(n==="--orientcenters")s.orientCenters=!0;else if(n==="--puzzleorientation")s.puzzleOrientation=JSON.parse(t[e]),e++;else throw new Error(`Bad option: ${n}`)}return{puzzleDescription:Nt(t.slice(e).join(" ")),options:s}}var te=class{constructor(t={}){this.verbosity=0,this.allMoves=!1,this.vertexMoves=!1,this.addRotations=!1,this.moveList=null,this.fixedOrientation=!1,this.fixedPieceType=null,this.orientCenters=!1,this.includeCornerOrbits=!0,this.includeCenterOrbits=!0,this.includeEdgeOrbits=!0,this.excludeOrbits=[],this.optimizeOrbits=!1,this.grayCorners=!1,this.grayCenters=!1,this.grayEdges=!1,this.puzzleOrientation=null,this.puzzleOrientations=null,this.scrambleAmount=0,Object.assign(this,t)}},dt=[],gt=[];function nt(t){if(!dt[t]){let e=Array(t);for(let s=0;s<t;s++)e[s]=0;dt[t]=e}return dt[t]}function q(t){if(!gt[t]){let e=Array(t);for(let s=0;s<t;s++)e[s]=s;gt[t]=e}return gt[t]}function ee(t){return new tt(q(t))}function se(t){let e=BigInt(1);for(;t>1;)e*=BigInt(t),t--;return e}function ie(t,e){if(t>e){let s=t;t=e,e=s}for(;t>0;){let s=e%t;e=t,t=s}return e}function St(t,e){return t/ie(t,e)*e}var tt=class{constructor(t){this.n=t.length,this.p=t}toString(){return`Perm[${this.p.join(" ")}]`}mul(t){let e=Array(this.n);for(let s=0;s<this.n;s++)e[s]=t.p[this.p[s]];return new tt(e)}rmul(t){let e=Array(this.n);for(let s=0;s<this.n;s++)e[s]=this.p[t.p[s]];return new tt(e)}inv(){let t=Array(this.n);for(let e=0;e<this.n;e++)t[this.p[e]]=e;return new tt(t)}compareTo(t){for(let e=0;e<this.n;e++)if(this.p[e]!==t.p[e])return this.p[e]-t.p[e];return 0}toGap(){let t=new Array,e=new Array(this.n);for(let s=0;s<this.p.length;s++){if(e[s]||this.p[s]===s)continue;let i=new Array;for(let n=s;!e[n];n=this.p[n])i.push(1+n),e[n]=!0;t.push(`(${i.join(",")})`)}return t.join("")}order(){let t=1,e=new Array(this.n);for(let s=0;s<this.p.length;s++){if(e[s]||this.p[s]===s)continue;let i=0;for(let n=s;!e[n];n=this.p[n])i++,e[n]=!0;t=St(t,i)}return t}},vt=class{constructor(t,e){this.size=t,this.mod=e}reassemblySize(){return se(this.size)*BigInt(this.mod)**BigInt(this.size)}},ne=0;function yt(t,e){let s=k.fromString(e),i=t.notationToExternal(s);return i===null||s===i?e:i.toString()}var Lt=class{constructor(t,e,s,i,n,o,r){this.orbitnames=t,this.orbitdefs=e,this.solved=s,this.movenames=i,this.moveops=n,this.isRotation=o,this.forcenames=r}transformToKTransformationData(t){let e={};for(let s=0;s<this.orbitnames.length;s++)e[this.orbitnames[s]]=t.orbits[s].toKPuzzle();return e}static transformToKTransformationData(t,e){let s={};for(let i=0;i<t.length;i++)s[t[i]]=e.orbits[i].toKPuzzle();return s}describeSet(t,e,s){let i=this.orbitdefs[t].size,n=new Array(i);for(let o=0;o<i;o++)n[o]=[];for(let o=0;o<this.movenames.length;o++){if(this.isRotation[o])continue;let r=this.movenames[o];this.forcenames[o]||(r=yt(s,r),r[r.length-1]==="'"&&(r=r.substring(0,r.length-1)));let m=this.moveops[o].orbits[t];for(let c=0;c<i;c++)(m.perm[c]!==c||m.ori[c]!==0)&&n[c].push(r)}for(let o=0;o<i;o++)e.push(`# ${o+1} ${n[o].join(" ")}`)}toKsolve(t,e=new $t){let s=[];s.push(`Name ${t}`),s.push("");for(let i=0;i<this.orbitnames.length;i++)s.push(`Set ${this.orbitnames[i]} ${this.orbitdefs[i].size} ${this.orbitdefs[i].mod}`),this.describeSet(i,s,e);s.push(""),s.push("Solved");for(let i=0;i<this.orbitnames.length;i++)this.solved.orbits[i].appendDefinition(s,this.orbitnames[i],!1,!1);s.push("End");for(let i=0;i<this.movenames.length;i++){s.push("");let n=this.movenames[i];this.forcenames[i]||(n=yt(e,this.movenames[i]));let o=!1;n[n.length-1]==="'"&&(o=!0,n=n.substring(0,n.length-1)),s.push(`Move ${n}`);for(let r=0;r<this.orbitnames.length;r++)o?this.moveops[i].orbits[r].inv().appendDefinition(s,this.orbitnames[r],!0):this.moveops[i].orbits[r].appendDefinition(s,this.orbitnames[r],!0);s.push("End")}return s}toKPuzzleDefinition(t){let e={},s={};for(let n=0;n<this.orbitnames.length;n++){e[this.orbitnames[n]]={numPieces:this.orbitdefs[n].size,numOrientations:this.orbitdefs[n].mod};let o=this.solved.orbits[n].toKPuzzle();s[this.orbitnames[n]]={pieces:o.permutation,orientation:o.orientation}}let i={};if(t)for(let n=0;n<this.movenames.length;n++)i[this.movenames[n]]=this.transformToKTransformationData(this.moveops[n]);return{name:`PG3D #${++ne}`,orbits:e,startStateData:s,moves:i}}optimize(){let t=[],e=[],s=[],i=[];for(let n=0;n<this.moveops.length;n++)i.push([]);for(let n=0;n<this.orbitdefs.length;n++){let o=this.orbitdefs[n].mod,r=this.orbitdefs[n].size,m=new Ut(r),c=new Array(this.orbitdefs[n].size);for(let b=0;b<r;b++)c[b]=!1;for(let b=0;b<this.moveops.length;b++)for(let h=0;h<r;h++)(this.moveops[b].orbits[n].perm[h]!==h||this.moveops[b].orbits[n].ori[h]!==0)&&(this.isRotation[b]||(c[h]=!0),m.union(h,this.moveops[b].orbits[n].perm[h]));let u=!0;if(o>1){u=!1;let b=new Ut(this.orbitdefs[n].size*o);for(let h=0;h<this.moveops.length;h++)for(let a=0;a<r;a++)if(this.moveops[h].orbits[n].perm[a]!==a||this.moveops[h].orbits[n].ori[a]!==0)for(let f=0;f<o;f++)b.union(a*o+f,this.moveops[h].orbits[n].perm[a]*o+(f+this.moveops[h].orbits[n].ori[a])%o);for(let h=0;!u&&h<r;h++)for(let a=1;a<o;a++)b.find(h*o)===b.find(h*o+a)&&(u=!0);for(let h=0;!u&&h<r;h++)for(let a=0;a<h;a++)this.solved.orbits[n].perm[h]===this.solved.orbits[n].perm[a]&&(u=!0)}let p=-1,d=!1;for(let b=0;b<this.orbitdefs[n].size;b++)if(c[b]){let h=m.find(b);p<0?p=h:p!==h&&(d=!0)}for(let b=0;b<this.orbitdefs[n].size;b++){if(!c[b]||m.find(b)!==b)continue;let a=[],f=[],v=0;for(let F=0;F<this.orbitdefs[n].size;F++)m.find(F)===b&&(a[v]=F,f[F]=v,v++);if(d?t.push(`${this.orbitnames[n]}_p${b}`):t.push(this.orbitnames[n]),u){e.push(new vt(v,this.orbitdefs[n].mod)),s.push(this.solved.orbits[n].remapVS(a,v));for(let F=0;F<this.moveops.length;F++)i[F].push(this.moveops[F].orbits[n].remap(a,f,v))}else{e.push(new vt(v,1)),s.push(this.solved.orbits[n].remapVS(a,v).killOri());for(let F=0;F<this.moveops.length;F++)i[F].push(this.moveops[F].orbits[n].remap(a,f,v).killOri())}}}return new Lt(t,e,new Ft(s),this.movenames,i.map(n=>new rt(n)),this.isRotation,this.forcenames)}scramble(t){this.solved=this.solved.mul(this.getScrambleTransformation(t))}getScrambleTransformation(t){t<100&&(t=100);let e=[];for(let i=0;i<this.moveops.length;i++)e[i]=this.moveops[i];for(let i=0;i<e.length;i++){let n=Math.floor(Math.random()*e.length),o=e[i];e[i]=e[n],e[n]=o}t<e.length&&(t=e.length);for(let i=0;i<t;i++){let n=Math.floor(Math.random()*e.length),o=Math.floor(Math.random()*e.length),r=Math.floor(Math.random()*this.moveops.length);e[n]=e[n].mul(e[o]).mul(this.moveops[r]),Math.random()<.1&&(e[n]=e[n].mul(this.moveops[r]))}let s=e[0];for(let i=1;i<e.length;i++)s=s.mul(e[i]);return s}reassemblySize(){let t=BigInt(1);for(let e=0;e<this.orbitdefs.length;e++)t*=this.orbitdefs[e].reassemblySize();return t}},Y=class{constructor(t,e,s){this.perm=t,this.ori=e,this.orimod=s}static e(t,e){return new Y(q(t),nt(t),e)}mul(t){let e=this.perm.length,s=new Array(e);if(this.orimod===1){for(let i=0;i<e;i++)s[i]=this.perm[t.perm[i]];return new Y(s,this.ori,this.orimod)}else{let i=new Array(e);for(let n=0;n<e;n++)s[n]=this.perm[t.perm[n]],i[n]=(this.ori[t.perm[n]]+t.ori[n])%this.orimod;return new Y(s,i,this.orimod)}}inv(){let t=this.perm.length,e=new Array(t),s=new Array(t);for(let i=0;i<t;i++)e[this.perm[i]]=i,s[this.perm[i]]=(this.orimod-this.ori[i])%this.orimod;return new Y(e,s,this.orimod)}equal(t){let e=this.perm.length;for(let s=0;s<e;s++)if(this.perm[s]!==t.perm[s]||this.ori[s]!==t.ori[s])return!1;return!0}killOri(){let t=this.perm.length;for(let e=0;e<t;e++)this.ori[e]=0;return this.orimod=1,this}toPerm(){let t=this.orimod;if(t===1)return new tt(this.perm);let e=this.perm.length,s=new Array(e*t);for(let i=0;i<e;i++)for(let n=0;n<t;n++)s[i*t+n]=t*this.perm[i]+(this.ori[i]+n)%t;return new tt(s)}identicalPieces(){let t=[],e=this.perm.length,s=[];for(let i=0;i<e;i++){let n=this.perm[i];if(t[n]===void 0){let o=[i];t[n]=!0;for(let r=i+1;r<e;r++)this.perm[r]===n&&o.push(r);s.push(o)}}return s}order(){return this.toPerm().order()}isIdentity(){let t=this.perm.length;if(this.perm===q(t)&&this.ori===nt(t))return!0;for(let e=0;e<t;e++)if(this.perm[e]!==e||this.ori[e]!==0)return!1;return!0}zeroOris(){let t=this.perm.length;if(this.ori===nt(t))return!0;for(let e=0;e<t;e++)if(this.ori[e]!==0)return!1;return!0}remap(t,e,s){let i=new Array(s),n=new Array(s);for(let o=0;o<s;o++)i[o]=e[this.perm[t[o]]],n[o]=this.ori[t[o]];return new Y(i,n,this.orimod)}remapVS(t,e){let s=new Array(e),i=new Array(e),n=0,o=[];for(let r=0;r<e;r++){let m=this.perm[t[r]];o[m]===void 0&&(o[m]=n++),s[r]=o[m],i[r]=this.ori[t[r]]}return new Y(s,i,this.orimod)}appendDefinition(t,e,s,i=!0){if(!(i&&this.isIdentity())&&(t.push(e),t.push(this.perm.map(n=>n+1).join(" ")),!this.zeroOris()))if(s){let n=new Array(this.ori.length);for(let o=0;o<n.length;o++)n[this.perm[o]]=this.ori[o];t.push(n.join(" "))}else t.push(this.ori.join(" "))}toKPuzzle(){let t=this.perm.length;return this.isIdentity()?(Y.kcache[t]||(Y.kcache[t]={permutation:q(t),orientation:nt(t)}),Y.kcache[t]):{permutation:this.perm,orientation:this.ori}}},it=Y;it.kcache=[];var Tt=class{constructor(t){this.orbits=t}internalMul(t){let e=[];for(let s=0;s<this.orbits.length;s++)e.push(this.orbits[s].mul(t.orbits[s]));return e}internalInv(){let t=[];for(let e of this.orbits)t.push(e.inv());return t}equal(t){for(let e=0;e<this.orbits.length;e++)if(!this.orbits[e].equal(t.orbits[e]))return!1;return!0}killOri(){for(let t of this.orbits)t.killOri();return this}toPerm(){let t=new Array,e=0;for(let i of this.orbits){let n=i.toPerm();t.push(n),e+=n.n}let s=new Array(e);e=0;for(let i of t){for(let n=0;n<i.n;n++)s[e+n]=e+i.p[n];e+=i.n}return new tt(s)}identicalPieces(){let t=[],e=0;for(let s of this.orbits){let i=s.orimod,n=s.identicalPieces();for(let o=0;o<n.length;o++)t.push(n[o].map(r=>r*i+e));e+=i*s.perm.length}return t}order(){let t=1;for(let e of this.orbits)t=St(t,e.order());return t}},rt=class extends Tt{constructor(t){super(t)}mul(t){return new rt(this.internalMul(t))}mulScalar(t){if(t===0)return this.e();let e=this;for(t<0&&(e=e.inv(),t=-t);!(t&1);)e=e.mul(e),t>>=1;if(t===1)return e;let s=e,i=this.e();for(;t>0;)t&1&&(i=i.mul(s)),t>1&&(s=s.mul(s)),t>>=1;return i}inv(){return new rt(this.internalInv())}e(){return new rt(this.orbits.map(t=>it.e(t.perm.length,t.orimod)))}},Ft=class extends Tt{constructor(t){super(t)}mul(t){return new Ft(this.internalMul(t))}},Ut=class{constructor(t){this.n=t,this.heads=new Array(t);for(let e=0;e<t;e++)this.heads[e]=e}find(t){let e=this.heads[t];return this.heads[e]===e||(e=this.find(this.heads[e]),this.heads[t]=e),e}union(t,e){let s=this.find(t),i=this.find(e);s<i?this.heads[i]=s:s>i&&(this.heads[s]=i)}};function oe(t,e){let s=t.moveops.length;if(s>30)throw new Error("Canon info too big for bitmask");let i=[],n=[];for(let r=0;r<s;r++){let m=t.moveops[r];i.push(m.order());let c=0;for(let u=0;u<s;u++){if(u===r)continue;let p=t.moveops[u];m.mul(p).equal(p.mul(m))&&(c|=1<<u)}n.push(c)}let o={};o[0]=1;for(let r=0;r<100;r++){let m=0,c={},u=0;for(let p in o){let d=+p,b=o[d];m+=b,u++;for(let h=0;h<i.length;h++)if(!(d>>h&1)&&!(d&n[h]&(1<<h)-1)){let a=d&n[h]|1<<h;c[a]===void 0&&(c[a]=0),c[a]+=(i[h]-1)*b}}e(`${r}: canonseq ${m} states ${u}`),o=c}}var Bt={"2x2x2":"c f 0","3x3x3":"c f 0.333333333333333","4x4x4":"c f 0.5 f 0","5x5x5":"c f 0.6 f 0.2","6x6x6":"c f 0.666666666666667 f 0.333333333333333 f 0","7x7x7":"c f 0.714285714285714 f 0.428571428571429 f 0.142857142857143","8x8x8":"c f 0.75 f 0.5 f 0.25 f 0","9x9x9":"c f 0.777777777777778 f 0.555555555555556 f 0.333333333333333 f 0.111111111111111","10x10x10":"c f 0.8 f 0.6 f 0.4 f 0.2 f 0","11x11x11":"c f 0.818181818181818 f 0.636363636363636 f 0.454545454545455 f 0.272727272727273 f 0.0909090909090909","12x12x12":"c f 0.833333333333333 f 0.666666666666667 f 0.5 f 0.333333333333333 f 0.166666666666667 f 0","13x13x13":"c f 0.846153846153846 f 0.692307692307692 f 0.538461538461538 f 0.384615384615385 f 0.230769230769231 f 0.0769230769230769","20x20x20":"c f 0 f .1 f .2 f .3 f .4 f .5 f .6 f .7 f .8 f .9","30x30x30":"c f 0 f .066667 f .133333 f .2 f .266667 f .333333 f .4 f .466667 f .533333 f .6 f .666667 f .733333 f .8 f .866667 f .933333","40x40x40":"c f 0 f .05 f .1 f .15 f .2 f .25 f .3 f .35 f .4 f .45 f .5 f .55 f .6 f .65 f .7 f .75 f .8 f .85 f .9 f .95",skewb:"c v 0","master skewb":"c v 0.275","professor skewb":"c v 0 v 0.38","compy cube":"c v 0.915641442663986",helicopter:"c e 0.707106781186547","curvy copter":"c e 0.83",dino:"c v 0.577350269189626","little chop":"c e 0",pyramorphix:"t e 0",mastermorphix:"t e 0.346184634065199",pyraminx:"t v 0.333333333333333 v 1.66666666666667",tetraminx:"t v 0.333333333333333","master pyraminx":"t v 0 v 1 v 2","master tetraminx":"t v 0 v 1","professor pyraminx":"t v -0.2 v 0.6 v 1.4 v 2.2","professor tetraminx":"t v -0.2 v 0.6 v 1.4","Jing pyraminx":"t f 0","master pyramorphix":"t e 0.866025403784437",megaminx:"d f 0.7",gigaminx:"d f 0.64 f 0.82",teraminx:"d f 0.64 f 0.76 f 0.88",petaminx:"d f 0.64 f 0.73 f 0.82 f 0.91",examinx:"d f 0.64 f 0.712 f 0.784 f 0.856 f 0.928",zetaminx:"d f 0.64 f 0.7 f 0.76 f 0.82 f 0.88 f 0.94",yottaminx:"d f 0.64 f 0.6914 f 0.7429 f 0.7943 f 0.8457 f 0.8971 f 0.9486",pentultimate:"d f 0","master pentultimate":"d f 0.1","elite pentultimate":"d f 0 f 0.145905",starminx:"d v 0.937962370425399","starminx 2":"d f 0.23606797749979","pyraminx crystal":"d f 0.447213595499989",chopasaurus:"d v 0","big chop":"d e 0","skewb diamond":"o f 0",FTO:"o f 0.333333333333333","master FTO":"o f 0.5 f 0","Christopher's jewel":"o v 0.577350269189626",octastar:"o e 0","Trajber's octahedron":"o v 0.433012701892219","radio chop":"i f 0",icosamate:"i v 0","icosahedron 2":"i v 0.18759247376021","icosahedron 3":"i v 0.18759247376021 e 0","icosahedron static faces":"i v 0.84","icosahedron moving faces":"i v 0.73","Eitan's star":"i f 0.61803398874989","2x2x2 + dino":"c f 0 v 0.577350269189626","2x2x2 + little chop":"c f 0 e 0","dino + little chop":"c v 0.577350269189626 e 0","2x2x2 + dino + little chop":"c f 0 v 0.577350269189626 e 0","megaminx + chopasaurus":"d f 0.61803398875 v 0","starminx combo":"d f 0.23606797749979 v 0.937962370425399"},st=1e-9;function bt(t){let e=new U(0,0,0,0);for(let s=0;s<t.length;s++)e=e.sum(t[s]);return e.smul(1/t.length)}function re(t,e,s,i){let n=i[t].intersect3(i[e],i[s]);if(!n)return n;for(let o=0;o<i.length;o++)if(o!==t&&o!==e&&o!==s){let r=i[o].b*n.b+i[o].c*n.c+i[o].d*n.d;if(i[o].a>0&&r>i[o].a||i[o].a<0&&r<i[o].a)return!1}return n}var U=class{constructor(t,e,s,i){this.a=t,this.b=e,this.c=s,this.d=i}mul(t){return new U(this.a*t.a-this.b*t.b-this.c*t.c-this.d*t.d,this.a*t.b+this.b*t.a+this.c*t.d-this.d*t.c,this.a*t.c-this.b*t.d+this.c*t.a+this.d*t.b,this.a*t.d+this.b*t.c-this.c*t.b+this.d*t.a)}toString(){return`Q[${this.a},${this.b},${this.c},${this.d}]`}dist(t){return Math.hypot(this.a-t.a,this.b-t.b,this.c-t.c,this.d-t.d)}len(){return Math.hypot(this.a,this.b,this.c,this.d)}cross(t){return new U(0,this.c*t.d-this.d*t.c,this.d*t.b-this.b*t.d,this.b*t.c-this.c*t.b)}dot(t){return this.b*t.b+this.c*t.c+this.d*t.d}normalize(){let t=Math.sqrt(this.dot(this));return new U(this.a/t,this.b/t,this.c/t,this.d/t)}makenormal(){return new U(0,this.b,this.c,this.d).normalize()}normalizeplane(){let t=Math.hypot(this.b,this.c,this.d);return new U(this.a/t,this.b/t,this.c/t,this.d/t)}smul(t){return new U(this.a*t,this.b*t,this.c*t,this.d*t)}sum(t){return new U(this.a+t.a,this.b+t.b,this.c+t.c,this.d+t.d)}sub(t){return new U(this.a-t.a,this.b-t.b,this.c-t.c,this.d-t.d)}angle(){return 2*Math.acos(this.a)}invrot(){return new U(this.a,-this.b,-this.c,-this.d)}det3x3(t,e,s,i,n,o,r,m,c){return t*(n*c-o*m)+e*(o*r-i*c)+s*(i*m-n*r)}rotateplane(t){let e=t.mul(new U(0,this.b,this.c,this.d)).mul(t.invrot());return e.a=this.a,e}orthogonal(){let t=Math.abs(this.b),e=Math.abs(this.c),s=Math.abs(this.d);return t<e&&t<s?this.cross(new U(0,1,0,0)).normalize():e<t&&e<s?this.cross(new U(0,0,1,0)).normalize():this.cross(new U(0,0,0,1)).normalize()}pointrotation(t){let e=this.normalize();if(t=t.normalize(),e.sub(t).len()<st)return new U(1,0,0,0);let s=e.sum(t);s.len()<st?s=s.orthogonal():s=s.normalize();let i=e.cross(s);return i.a=e.dot(s),i}unproject(t){return this.sum(t.smul(-this.dot(t)/(this.len()*t.len())))}rotatepoint(t){return t.mul(this).mul(t.invrot())}rotateface(t){return t.map(e=>e.rotatepoint(this))}intersect3(t,e){let s=this.det3x3(this.b,this.c,this.d,t.b,t.c,t.d,e.b,e.c,e.d);return Math.abs(s)<st?!1:new U(0,this.det3x3(this.a,this.c,this.d,t.a,t.c,t.d,e.a,e.c,e.d)/s,this.det3x3(this.b,this.a,this.d,t.b,t.a,t.d,e.b,e.a,e.d)/s,this.det3x3(this.b,this.c,this.a,t.b,t.c,t.a,e.b,e.c,e.a)/s)}side(t){return t>st?1:t<-st?-1:0}cutface(t){let e=this.a,s=0,i=null;for(let n=0;n<t.length;n++)s|=1<<this.side(t[n].dot(this)-e)+1;if((s&5)===5){i=[];let n=t.map(o=>this.side(o.dot(this)-e));for(let o=-1;o<=1;o+=2){let r=[];for(let m=0;m<t.length;m++){(n[m]===o||n[m]===0)&&r.push(t[m]);let c=(m+1)%t.length;if(n[m]+n[c]===0&&n[m]!==0){let u=t[m].dot(this)-e,p=t[c].dot(this)-e,d=u/(u-p),b=t[m].smul(1-d).sum(t[c].smul(d));r.push(b)}}i.push(r)}}return i}cutfaces(t){let e=[];for(let s=0;s<t.length;s++){let i=t[s],n=this.cutface(i);n?(e.push(n[0]),e.push(n[1])):e.push(i)}return e}faceside(t){let e=this.a;for(let s=0;s<t.length;s++){let i=this.side(t[s].dot(this)-e);if(i!==0)return i}throw new Error("Could not determine side of plane in faceside")}sameplane(t){let e=this.normalize(),s=t.normalize();return e.dist(s)<st||e.dist(s.smul(-1))<st}makecut(t){return new U(t,this.b,this.c,this.d)}},ct=1e-9;function ae(){let t=Math.sqrt(.5);return[new U(t,t,0,0),new U(t,0,t,0)]}function le(){return[new U(.5,.5,.5,.5),new U(.5,.5,.5,-.5)]}function he(){let t=2*Math.PI/10,e=.5+.3*Math.sqrt(5),s=.5+.1*Math.sqrt(5),i=Math.sqrt(e*e+s*s);return e/=i,s/=i,[new U(Math.cos(t),e*Math.sin(t),s*Math.sin(t),0),new U(.5,.5,.5,.5)]}function ce(){let t=.16666666666666666+Math.sqrt(5)/6,e=2/3+Math.sqrt(5)/3,s=Math.sqrt(t*t+e*e);t/=s,e/=s;let i=2*Math.PI/6;return[new U(Math.cos(i),t*Math.sin(i),e*Math.sin(i),0),new U(Math.cos(i),-t*Math.sin(i),e*Math.sin(i),0)]}function fe(){let t=Math.sqrt(.5);return[new U(.5,.5,.5,.5),new U(t,0,0,t)]}function ue(t){let e=[new U(1,0,0,0)];for(let s=0;s<e.length;s++)for(let i=0;i<t.length;i++){let n=t[i].mul(e[s]),o=n.smul(-1),r=!1;for(let m=0;m<e.length;m++)if(n.dist(e[m])<ct||o.dist(e[m])<ct){r=!0;break}r||e.push(n)}return e}function Pt(t,e){let s=[],i=[];for(let n=0;n<e.length;n++){let o=t.rotateplane(e[n]),r=!1;for(let m=0;m<s.length;m++)if(o.dist(s[m])<ct){r=!0;break}r||(s.push(o),i.push(e[n]))}return i}function Ot(t){let e=[];for(let s=1;s<t.length;s++)for(let i=s+1;i<t.length;i++){let n=re(0,s,i,t);if(n){let o=!1;for(let r=0;r<e.length;r++)if(n.dist(e[r])<ct){o=!0;break}o||e.push(n)}}for(;;){let s=!1;for(let i=0;i<e.length;i++){let n=(i+1)%e.length;if(t[0].dot(e[i].cross(e[n]))<0){let o=e[i];e[i]=e[n],e[n]=o,s=!0}}if(!s)break}return e}var pe=class{constructor(){this.mult=[]}multiply(t){for(let e=2;e*e<=t;e++)for(;t%e===0;)this.mult[e]!==void 0?this.mult[e]++:this.mult[e]=1,t/=e;t>1&&(this.mult[t]!==void 0?this.mult[t]++:this.mult[t]=1)}toString(){let t="";for(let e=0;e<this.mult.length;e++)this.mult[e]!==void 0&&(t!==""&&(t+="*"),t+=e,this.mult[e]>1&&(t+=`^${this.mult[e]}`));return t}};function me(t,e){let s=t[0].p.length,i=ee(s),n=[],o=[],r=[],m=[],c=[];function u(h){for(let a=h.p.length-1;a>=0;a--){let f=h.p[a];if(f!==a){if(!n[a][f])return!1;h=h.mul(o[a][f])}}return!0}function p(h,a,f){m[h].push(a),c[h].push(f);for(let v=0;v<n[h].length;v++)n[h][v]&&d(h,n[h][v].mul(a),f+r[h][v])}function d(h,a,f){let v=a.p[h];if(!n[h][v]){n[h][v]=a,o[h][v]=a.inv(),r[h][v]=f;for(let y=0;y<m[h].length;y++)d(h,a.mul(m[h][y]),f+c[h][y]);return}let F=a.mul(o[h][v]);u(F)||p(h-1,F,f+r[h][v])}function b(){n=[],o=[],m=[],r=[],c=[];for(let f=0;f<s;f++)n.push([]),o.push([]),r.push([]),m.push([]),c.push([]),n[f][f]=i,o[f][f]=i,r[f][f]=0;let h=0,a=BigInt(1);for(let f=0;f<t.length;f++){p(s-1,t[f],1),a=BigInt(1);let v=0,F=0,y=[],B=new pe;for(let M=0;M<s;M++){let $=0,Q=0;for(let C=0;C<s;C++)n[M][C]&&($++,Q+=r[M][C],M!==C&&h++);v+=m[M].length,a*=BigInt($),$>1&&B.multiply($);let N=Q/$;y.push(N),F+=N}e(`${f}: sz ${a} T ${v} sol ${F} none ${h} mults ${B.toString()}`)}return a}return b()}var at=class{constructor(t){this.coords=new Array(t.length*3);for(let e=0;e<t.length;e++)this.coords[3*e]=t[e].b,this.coords[3*e+1]=t[e].c,this.coords[3*e+2]=t[e].d;this.length=t.length}get(t){return new U(0,this.coords[3*t],this.coords[3*t+1],this.coords[3*t+2])}centermass(){let t=0,e=0,s=0;for(let i=0;i<this.length;i++)t+=this.coords[3*i],e+=this.coords[3*i+1],s+=this.coords[3*i+2];return new U(0,t/this.length,e/this.length,s/this.length)}rotate(t){let e=[];for(let s=0;s<this.length;s++)e.push(this.get(s).rotatepoint(t));return new at(e)}rotateforward(){let t=[];for(let e=1;e<this.length;e++)t.push(this.get(e));return t.push(this.get(0)),new at(t)}},xt=class{constructor(t,e,s){this.face=t,this.left=e,this.right=s}split(t){let e=t.cutface(this.face);return e!==null&&(this.left===void 0?(this.left=new xt(e[0]),this.right=new xt(e[1])):(this.left=this.left?.split(t),this.right=this.right?.split(t))),this}collect(t,e){return this.left===void 0?t.push(new at(this.face)):e?(this.left?.collect(t,!1),this.right?.collect(t,!0)):(this.right?.collect(t,!1),this.left?.collect(t,!0)),t}};function de(t,e){let s=[];for(let i of t)for(let n of e)s.push(n.rotate(i));return s}var G=1e-9,ge="PuzzleGeometry 0.1 Copyright 2018 Tomas Rokicki.",be=!1;function we(){return{4:[["F","D","L","R"]],6:[["F","D","L","U","R"],["R","F","","B",""]],8:[["F","D","L","R"],["D","F","BR",""],["BR","D","","BB"],["BB","BR","U","BL"]],12:[["U","F","","","",""],["F","U","R","C","A","L"],["R","F","","","E",""],["E","R","","BF","",""],["BF","E","BR","BL","I","D"]],20:[["R","C","F","E"],["F","R","L","U"],["L","F","A",""],["E","R","G","I"],["I","E","S","H"],["S","I","J","B"],["B","S","K","D"],["K","B","M","O"],["O","K","P","N"],["P","O","Q",""]]}}function ve(){return{4:{F:"#00ff00",D:"#ffff00",L:"#ff0000",R:"#0000ff"},6:{U:"#ffffff",F:"#00ff00",R:"#ff0000",D:"#ffff00",B:"#0000ff",L:"#ff8000"},8:{U:"#ffffff",F:"#ff0000",R:"#00bb00",D:"#ffff00",BB:"#1122ff",L:"#9524c5",BL:"#ff8800",BR:"#aaaaaa"},12:{U:"#ffffff",F:"#006633",R:"#ff0000",C:"#ffffd0",A:"#3399ff",L:"#660099",E:"#ff66cc",BF:"#99ff00",BR:"#0000ff",BL:"#ffff00",I:"#ff6633",D:"#999999"},20:{R:"#db69f0",C:"#178fde",F:"#23238b",E:"#9cc726",L:"#2c212d",U:"#177fa7",A:"#e0de7f",G:"#2b57c0",I:"#41126b",S:"#4b8c28",H:"#7c098d",J:"#7fe7b4",B:"#85fb74",K:"#3f4bc3",D:"#0ff555",M:"#f1c2c8",O:"#58d340",P:"#c514f2",N:"#14494e",Q:"#8b1be1"}}}var ye={4:{v:["DFR","DLF","DRL","FLR"],e:["FR","LF","DF","DL","RD","RL"],c:["DF","FD","RL","LR"]},6:{v:["URF","UBR","ULB","UFL","DFR","DRB","DBL","DLF"],e:["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],c:["UB","LU","FU","RU","BU","DF"]},8:{v:["UBBBRR","URFL","ULBLBB","DBRBBBL","DBLLF","DFRBR"],e:["UL","UBB","UR","BRD","BLD","FD","BRR","FR","FL","BLL","BLBB","BRBB"],c:["BBU","LU","RU","BRD","FD","BLD","DF","UBB"]},12:{v:["URF","UFL","ULBL","UBLBR","UBRR","DEBF","DBFI","DIA","DAC","DCE","LAI","ALF","FCA","CFR","REC","ERBR","BRBFE","BFBRBL","BLIBF","IBLL"],e:["UF","UR","UBR","UBL","UL","ER","EBR","EBF","ED","EC","IBF","IBL","IL","IA","ID","AC","CF","FA","BFBR","BRBL","BLBF","CD","AD","AL","FL","FR","CR","BFD","BRR","BLL"],c:["UF","FU","DBF","BFD","AD","CD","BRU","BLU","LA","RA","EBR","IBL"]},20:{v:["FLPQU","FUGER","FRCAL","HCREI","ISBDH","JSIEG","BSJMK","MQPOK","ONDBK","NOPLA","UQMJG","DNACH"],e:["FU","FL","FR","EG","ER","EI","SJ","SI","SB","KM","KB","KO","PQ","PO","PL","UG","JG","MQ","UQ","HC","HD","ND","NA","JM","CA","AL","CR","HI","DB","NO"],c:["FU","UF","GE","EG","JS","SJ","MK","KM","QP","PQ","LA","AL","RC","CR","IH","HI","BD","DB","ON","NO"]}};function xe(){return{4:[["FLR",[0,1,0]],["F",[0,0,1]]],6:[["U",[0,1,0]],["F",[0,0,1]]],8:[["U",[0,1,0]],["F",[0,0,1]]],12:[["U",[0,1,0]],["F",[0,0,1]]],20:[["GUQMJ",[0,1,0]],["F",[0,0,1]]]}}function lt(t,e){for(let s=0;s<t.length;s++)if(t[s][0].dist(e)<G)return s;throw new Error("Element not found")}function ke(){return Bt}function De(t){return Bt[t]}var Ee=["c","t","o","d","i"],je=["f","v","e"];function Nt(t){let e=t.split(/ /).filter(Boolean);if(e.length%2===0)return null;let s=e[0];if(s!=="o"&&s!=="c"&&s!=="i"&&s!=="d"&&s!=="t")return null;let i=[];for(let n=1;n<e.length;n+=2){if(e[n]!=="f"&&e[n]!=="v"&&e[n]!=="e")return null;i.push({cutType:e[n],distance:parseFloat(e[n+1])})}return{shape:s,cuts:i}}function Le(t,e={}){let s=Nt(t);if(s===null)throw new Error("Could not parse the puzzle description");let i=new Me(s,Object.assign({},{allMoves:!0},e));return i.allstickers(),i.genperms(),i}function Ce(t,e){return Le(Bt[t],e)}function Fe(t,e,s){let i=!1;s-e[1]<e[0]&&(t=[t[2],t[3],t[0],t[1]],e=[s-e[1],s-e[0]],i=!0);let n=t[0],o="";if(e[0]===0&&e[1]===s)n=`${n}v`;else if(e[0]===e[1])e[1]>0&&(o=String(e[1]+1));else if(e[0]===0)n=n.toLowerCase(),e[1]>1&&(o=String(e[1]+1));else throw new Error(`We only support slice and outer block moves right now. ${e}`);return[o+n,i]}function Be(t,e){let s=[],i=0;for(;i<t.length;){i>0&&i<t.length&&t[i]==="_"&&i++;let n="";for(let o of e)t.substr(i).startsWith(o[1])&&o[1].length>n.length&&(n=o[1]);if(n!=="")s.push(n),i+=n.length;else throw new Error(`Could not split ${t} into face names.`)}return s}function ht(t,e){return[t.b/e,-t.c/e,t.d/e]}function wt(t,e){let s=[],i=t.length;for(let n=0;n<i;n++){let o=ht(t.get(i-n-1),e);s[3*n]=o[0],s[3*n+1]=o[1],s[3*n+2]=o[2]}return s}var Me=class{constructor(t,e){this.puzzleDescription=t,this.cmovesbyslice=[],this.duplicatedFaces=[],this.duplicatedCubies=[],this.fixedCubie=-1,this.net=[],this.colors=[],this.notationMapper=new $t,this.addNotationMapper="",this.setReidOrder=!1;let s="genperms";this.options=new te(e),this.options.verbosity>0&&console.log(this.header("# ")),this.create(t)}create(t){let{shape:e,cuts:s}=t;this.moveplanes=[],this.moveplanes2=[],this.faces=[],this.cubies=[];let i=null;switch(e){case"c":{i=ae();break}case"o":{i=fe();break}case"i":{i=ce();break}case"t":{i=le();break}case"d":{i=he();break}default:throw new Error(`Bad shape argument: ${e}`)}this.rotations=ue(i),this.options.verbosity&&console.log(`# Rotations: ${this.rotations.length}`);let n=i[0];this.baseplanerot=Pt(n,this.rotations);let o=this.baseplanerot.map(l=>n.rotateplane(l));this.baseplanes=o,this.baseFaceCount=o.length;let r=we()[o.length];this.net=r,this.colors=ve()[o.length],this.options.verbosity>0&&console.log(`# Base planes: ${o.length}`);let m=Ot(o),c=new U(0,0,0,0);this.options.verbosity>0&&console.log(`# Face vertices: ${m.length}`);let u=o[0].makenormal(),p=m[0].sum(m[1]).makenormal(),d=m[0].makenormal(),b=new U(1,u.b,u.c,u.d);this.options.verbosity>0&&console.log(`# Boundary is ${b}`);let a=Pt(b,this.rotations).map(l=>b.rotateplane(l)),f=Ot(a);this.edgedistance=f[0].sum(f[1]).smul(.5).dist(c),this.vertexdistance=f[0].dist(c);let v=[],F=[],y=!1,B=!1,M=!1;for(let l of s){let L=null,E=0;switch(l.cutType){case"f":{L=u,E=1,y=!0;break}case"v":{L=d,E=this.vertexdistance,M=!0;break}case"e":{L=p,E=this.edgedistance,B=!0;break}default:throw new Error(`Bad cut argument: ${l.cutType}`)}v.push(L.makecut(l.distance)),F.push(l.distance<E)}this.options.addRotations&&(y||v.push(u.makecut(10)),M||v.push(d.makecut(10)),B||v.push(p.makecut(10))),this.basefaces=[];for(let l of this.baseplanerot){let L=l.rotateface(f);this.basefaces.push(new at(L))}let $=[],Q=[],N=[],C=[],g=f.length;function z(l,L,E){for(let R of l)if(R[0].dist(L)<G){R.push(E);return}l.push([L,E])}for(let l=0;l<this.baseplanerot.length;l++){let L=this.baseplanerot[l].rotateface(f);for(let E=0;E<L.length;E++){let R=(E+1)%L.length,S=L[E].sum(L[R]).smul(.5);z(C,S,l)}}let j=[];for(let l=0;l<this.baseplanerot.length;l++){let L=this.baseplanerot[l].rotateface(f),E=[];for(let R=0;R<L.length;R++){let S=(R+1)%L.length,T=L[R].sum(L[S]).smul(.5),Z=C[lt(C,T)];if(l===Z[1])E.push(Z[2]);else if(l===Z[2])E.push(Z[1]);else throw new Error("Could not find edge")}j.push(E)}let w={},x=[];x.push(r[0][0]),w[r[0][0]]=0,x[j[0][0]]=r[0][1],w[r[0][1]]=j[0][0];for(let l of r){let L=l[0],E=w[L];if(E===void 0)throw new Error("Bad edge description; first edge not connected");let R=-1;for(let S=0;S<j[E].length;S++){let T=x[j[E][S]];if(T!==void 0&&T===l[1]){R=S;break}}if(R<0)throw new Error("First element of a net not known");for(let S=2;S<l.length;S++){if(l[S]==="")continue;let T=j[E][(S+R-1)%g],Z=x[T];if(Z!==void 0&&Z!==l[S])throw new Error("Face mismatch in net");x[T]=l[S],w[l[S]]=T}}for(let l=0;l<this.baseplanerot.length;l++){let L=this.baseplanerot[l].rotateface(f),E=b.rotateplane(this.baseplanerot[l]),R=x[l];$.push([L,R]),Q.push([E,R])}for(let l=0;l<this.baseplanerot.length;l++){let L=this.baseplanerot[l].rotateface(f),E=x[l];for(let R=0;R<L.length;R++){let S=(R+1)%L.length,T=L[R].sum(L[S]).smul(.5),Z=(R+2)%L.length,At=L[S].sum(L[Z]).smul(.5),Gt=lt(C,T),Kt=lt(C,At);z(N,L[S],[E,Kt,Gt])}}this.swizzler=new ft($.map(l=>l[1]));let D=this.swizzler.prefixFree?"":"_",P=ye[this.baseFaceCount],O=[];for(let l=0;l<this.baseFaceCount;l++)O[1<<l]=l;{let l=P.v;for(let L of l){let E=this.swizzler.splitByFaceNames(L),R=0;for(let S of E)R|=1<<S;O[R]=E[0]}}{let l=P.e;for(let L of l){let E=this.swizzler.splitByFaceNames(L),R=0;for(let S of E)R|=1<<S;O[R]=E[0]}}{let l=P.c;for(let L of l){let E=this.swizzler.splitByFaceNames(L),R=1<<E[0]|1<<this.baseFaceCount;O[R]=E[1]}}for(let l=0;l<C.length;l++){if(C[l].length!==3)throw new Error(`Bad length in edge names ${C[l]}`);let L=C[l][1],E=C[l][2],R=x[L],S=x[E],T=1<<L|1<<E;O[T]===L?R=R+D+S:R=S+D+R,C[l]=[C[l][0],R]}for(let l=0;l<N.length;l++){let L=0;if(N[l].length<4)throw new Error("Bad length in vertex names");for(let T=1;T<N[l].length;T++)L|=1<<w[N[l][T][0]];let E=O[L],R=-1;for(let T=1;T<N[l].length;T++)E===w[N[l][T][0]]&&(R=T);if(R<0)throw new Error("Internal error; couldn't find face name when fixing corners");let S="";for(let T=1;T<N[l].length;T++){T===1?S=N[l][R][0]:S=S+D+N[l][R][0];for(let Z=1;Z<N[l].length;Z++)if(N[l][R][1]===N[l][Z][2]){R=Z;break}}N[l]=[N[l][0],S]}this.markedface=O,this.options.verbosity>1&&(console.log(`# Face names: ${$.map(l=>l[1]).join(" ")}`),console.log(`# Edge names: ${C.map(l=>l[1]).join(" ")}`),console.log(`# Vertex names: ${N.map(l=>l[1]).join(" ")}`));let A=[];for(let l of Q)A.push([l[0].makenormal(),l[1],"f"]);for(let l of C)A.push([l[0].makenormal(),l[1],"e"]);for(let l of N)A.push([l[0].makenormal(),l[1],"v"]);this.facenames=$,this.faceplanes=Q,this.edgenames=C,this.vertexnames=N,this.geonormals=A;let K=A.map(l=>l[1]);this.swizzler.setGripNames(K),this.options.verbosity>0&&console.log(`# Distances: face ${1} edge ${this.edgedistance} vertex ${this.vertexdistance}`);for(let l=0;l<v.length;l++)for(let L of this.rotations){let E=v[l].rotateplane(L),R=!1;for(let S of this.moveplanes)if(E.sameplane(S)){R=!0;break}R||(this.moveplanes.push(E),F[l]&&this.moveplanes2.push(E))}let W=new xt(f),J=this.moveplanes2.slice(),et=31;for(let l=0;l<J.length;l++){let L=l+Math.floor((J.length-l)*(et/65536));W=W.split(J[L]),J[L]=J[l],et=(et*1657+101)%65536}let H=W.collect([],!0);this.faces=H,this.options.verbosity>0&&console.log(`# Faces is now ${H.length}`),this.stickersperface=H.length;let ot=[],V=bt(f);for(let l of this.rotations){let L=l.rotateface(f);V.dist(bt(L))<G&&ot.push(l)}let X=new Array(H.length),_=[];for(let l=0;l<H.length;l++){let L=H[l].centermass();_.push([V.dist(L),L,l])}_.sort((l,L)=>l[0]-L[0]);for(let l=0;l<H.length;l++){let L=_[l][2];if(!X[L]){X[L]=!0;for(let E of ot){let R=H[L].rotate(E),S=R.centermass();for(let T=l+1;T<H.length&&!(_[T][0]-_[l][0]>G);T++){let Z=_[T][2];if(!X[Z]&&S.dist(_[T][1])<G){X[Z]=!0,H[Z]=R;break}}}}}this.shortedge=1e99;for(let l of H)for(let L=0;L<l.length;L++){let E=(L+1)%l.length,R=l.get(L).dist(l.get(E));R<this.shortedge&&(this.shortedge=R)}this.options.verbosity>0&&console.log(`# Short edge is ${this.shortedge}`),e==="c"&&y&&!B&&!M&&(this.addNotationMapper="NxNxNCubeMapper",this.setReidOrder=!0),e==="c"&&M&&!y&&!B&&(this.addNotationMapper="SkewbMapper"),e==="t"&&(M||y)&&!B&&(this.addNotationMapper="PyraminxOrTetraminxMapper"),e==="o"&&y&&(this.notationMapper=new Mt(this.swizzler,new ft(["F","D","L","BL","R","U","BR","B"])),B||M||(this.addNotationMapper="FTOMapper")),e==="d"&&y&&(this.addNotationMapper="MegaminxMapper",this.notationMapper=new Mt(this.swizzler,new ft(["U","F","L","BL","BR","R","FR","FL","DL","B","DR","D"])))}keyface(t){return this.keyface2(t.centermass())}keyface2(t){let e="",s=String.fromCharCode;for(let i of this.moveplanesets)if(i.length>0){let n=t.dot(i[0]),o=0,r=1;for(;r*2<=i.length;)r*=2;for(;r>0;r>>=1)o+r<=i.length&&n>i[o+r-1].a&&(o+=r);if(o<47)e=e+s(33+o);else if(o<47+47*47)e=e+s(33+47+Math.floor(o/47)-1)+s(33+o%47);else if(o<47+47*47+47*47*47)e=e+s(33+47+Math.floor((o-47)/(47*47)-1))+s(33+47+Math.floor((o-47)/47)%47)+s(33+o%47);else throw Error("Too many slices for cubie encoding")}return e}keyface3(t){let e=t.centermass(),s=[];for(let i of this.moveplanesets)if(i.length>0){let n=e.dot(i[0]),o=0,r=1;for(;r*2<=i.length;)r*=2;for(;r>0;r>>=1)o+r<=i.length&&n>i[o+r-1].a&&(o+=r);s.push(o)}return s}findface(t){let e=this.keyface2(t),s=this.facelisthash.get(e);if(s.length===1)return s[0];for(let i=0;i+1<s.length;i++){let n=this.facelisthash.get(e)[i];if(Math.abs(t.dist(this.facecentermass[n]))<G)return n}return s[s.length-1]}project2d(t,e,s){let i=this.facenames[t][0],n=(e+1)%i.length,o=this.baseplanes[t],r=i[n].sub(i[e]),m=r.len();r=r.normalize();let c=r.cross(o).normalize(),u=s[1].sub(s[0]),p=u.len()/m;u=u.normalize();let d=u.b,b=u.c,h=r.smul(d).sub(c.smul(b)).smul(p),a=c.smul(d).sum(r.smul(b)).smul(p),f=new U(0,s[0].b-h.dot(i[e]),s[0].c-a.dot(i[e]),0);return[h,a,f]}allstickers(){let t="allstickers";this.faces=de(this.baseplanerot,this.faces),this.options.verbosity>0&&console.log(`# Total stickers is now ${this.faces.length}`),this.facecentermass=new Array(this.faces.length);for(let g=0;g<this.faces.length;g++)this.facecentermass[g]=this.faces[g].centermass();let e=[],s=[];for(let g of this.moveplanes){let z=g.makenormal(),j=!1;for(let w of s)z.sameplane(w.makenormal())&&(j=!0);j||(s.push(z),e.push([]))}for(let g of this.moveplanes2){let z=g.makenormal();for(let j=0;j<s.length;j++)if(z.sameplane(s[j])){e[j].push(g);break}}for(let g=0;g<e.length;g++){let z=e[g].map(w=>w.normalizeplane()),j=s[g];for(let w=0;w<z.length;w++)z[w].makenormal().dist(j)>G&&(z[w]=z[w].smul(-1));z.sort((w,x)=>w.a-x.a),e[g]=z}this.moveplanesets=e,this.moveplanenormals=s;let i=e.map(g=>g.length);this.options.verbosity>0&&console.log(`# Move plane sets: ${i}`);let n=[];for(let g=0;g<e.length;g++)n.push([]);for(let g of this.rotations){if(Math.abs(Math.abs(g.a)-1)<G)continue;let z=g.makenormal();for(let j=0;j<e.length;j++)if(z.sameplane(s[j])){n[j].push(g);break}}this.moverotations=n;for(let g=0;g<n.length;g++){let z=n[g],j=z[0].makenormal();for(let w=0;w<z.length;w++)j.dist(z[w].makenormal())>G&&(z[w]=z[w].smul(-1));z.sort((w,x)=>w.angle()-x.angle()),n[g][0].dot(s[g])<0&&z.reverse()}let o=n.map(g=>1+g.length);this.movesetorders=o;let r=[],m="?";for(let g=0;g<e.length;g++){let z=s[g],j=null,w=null;for(let x of this.geonormals){let D=z.dot(x[0]);Math.abs(D-1)<G?(w=[x[1],x[2]],m=x[2]):Math.abs(D+1)<G&&(j=[x[1],x[2]],m=x[2])}if(w===null||j===null)throw new Error("Saw positive or negative sides as null");r.push([w[0],w[1],j[0],j[1],1+e[g].length]),this.addNotationMapper==="NxNxNCubeMapper"&&m==="f"&&(this.notationMapper=new Ht(1+e[g].length),this.addNotationMapper=""),this.addNotationMapper==="SkewbMapper"&&e[0].length===1&&(this.notationMapper=new qt(this.swizzler),this.addNotationMapper=""),this.addNotationMapper==="PyraminxOrTetraminxMapper"&&(e[0].length===2&&e[0][0].a===.333333333333333&&e[0][1].a===1.66666666666667?(this.notationMapper=new It(this.swizzler),this.addNotationMapper=""):(this.notationMapper=new Jt(this.swizzler),this.addNotationMapper="")),this.addNotationMapper==="MegaminxMapper"&&m==="f"&&(1+e[g].length===3&&(this.notationMapper=new _t(this.notationMapper)),this.addNotationMapper=""),this.addNotationMapper==="FTOMapper"&&m==="f"&&(1+e[g].length===3&&(this.notationMapper=new Qt(this.notationMapper,this.swizzler)),this.addNotationMapper="")}this.movesetgeos=r;let c=new Map,u=this.faces;for(let g=0;g<u.length;g++){let z=u[g],j=this.keyface(z);if(!c.get(j))c.set(j,[g]);else{let w=c.get(j);if(w.push(g),w.length===this.baseFaceCount){this.options.verbosity>0&&console.log("# Splitting core.");for(let x=0;x<w.length;x++){let D=`${j} ${x}`;c.set(D,[w[x]])}}}}this.facelisthash=c,this.options.verbosity>0&&console.log(`# Cubies: ${c.size}`);let p=[],d=[],b=[];for(let g of c.values())if(g.length!==this.baseFaceCount){if(g.length>1){let z=g.map(P=>u[P].centermass()),j=bt(z);for(let P=0;g.length>2;P++){let O=!1;for(let A=0;A<g.length;A++){let K=(A+1)%g.length;if(j.dot(z[A].cross(z[K]))<0){let W=z[A];z[A]=z[K],z[K]=W;let J=g[A];g[A]=g[K],g[K]=J,O=!0}}if(!O)break;if(P>1e3)throw new Error("Bad epsilon math; too close to border")}let w=0;for(let P of g)w|=1<<Math.floor(P/this.stickersperface);let x=this.markedface[w],D=-1;for(let P=0;P<g.length;P++)Math.floor(g[P]/this.stickersperface)===x&&(D=P);if(D<0)throw new Error("Could not find marked face in list");if(D!==0){let P=g.slice();for(let O=0;O<g.length;O++)g[O]=P[(D+O)%g.length]}}for(let z=0;z<g.length;z++){let j=g[z];d[j]=p.length,b[j]=z}p.push(g)}this.cubies=p,this.facetocubie=d,this.facetoord=b;let h=["?","CENTERS","EDGES","CORNERS","C4RNER","C5RNER"],a=[],f=[0,0,0,0,0,0],v=[],F=[],y=0,B=[],M=[],$=[],Q=[],N=g=>p[g].map(z=>this.getfaceindex(z)).join(" "),C=[];for(let g=0;g<p.length;g++){let z=p[g];if(z.length===0||F[g])continue;let j={},w=0;$.push(0),C.push([]);let x=z.length,D=f[x]++,P=h[x];(P===void 0||x===this.baseFaceCount)&&(P="CORE"),P=P+(D===0?"":D+1),a[y]=P,v[y]=x;let O=[g],A=0;for(F[g]=!0;A<O.length;){let K=O[A++],W=N(K);if((z.length>1||j[W]===void 0)&&(j[W]=w++),Q[K]=j[W],B[K]=y,C[y].push(K),M[K]=$[y]++,O.length<this.rotations.length){let J=this.facecentermass[p[K][0]];for(let et of n){let H=this.facetocubie[this.findface(J.rotatepoint(et[0]))];F[H]||(O.push(H),F[H]=!0)}}}y++}if(this.setReidOrder&&4<=this.stickersperface&&this.stickersperface<=9){let g=[["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],["UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"],["U","L","F","R","B","D"]],z={};for(let j of g)for(let w=0;w<j.length;w++){let x=0;for(let D=0;D<j[w].length;D++)x|=1<<j[w].charCodeAt(D)-65;z[x]=w}for(let j of C)for(let w of j){let x=0;for(let D of p[w])x|=1<<this.facenames[this.getfaceindex(D)][1].charCodeAt(0)-65;M[w]=z[x]}}if(this.cubiesetnums=B,this.cubieordnums=M,this.cubiesetnames=a,this.cubieords=$,this.orbitoris=v,this.cubievaluemap=Q,this.cubiesetcubies=C,this.options.fixedPieceType!==null){for(let g=0;g<p.length;g++)if(this.options.fixedPieceType==="v"&&p[g].length>2||this.options.fixedPieceType==="e"&&p[g].length===2||this.options.fixedPieceType==="f"&&p[g].length===1){this.fixedCubie=g;break}if(this.fixedCubie<0)throw new Error(`Could not find a cubie of type ${this.options.fixedPieceType} to fix.`)}this.options.verbosity>0&&console.log(`# Cubie orbit sizes ${$}`)}unswizzle(t){let e=this.notationMapper.notationToInternal(t);return e===null?null:e.modified({family:this.swizzler.unswizzle(e.family)})}stringToBlockMove(t){let e=RegExp("^(([0-9]+)-)?([0-9]+)?([^0-9]+)([0-9]+'?)?$"),s=t.match(e);if(s===null)throw new Error(`Bad move passed ${t}`);let i=s[4],n,o;if(s[2]!==void 0){if(s[3]===void 0)throw new Error("Missing second number in range");n=parseInt(s[2],10)}s[3]!==void 0&&(o=parseInt(s[3],10));let r="1",m=1;return s[5]!==void 0&&(r=s[5],r[0]==="'"&&(r=`-${r.substring(1)}`),m=parseInt(r,10)),new k(new I(i,o,n),m)}parseMove(t){let e=this.notationMapper.notationToInternal(t);if(e===null)throw new Error(`Bad move ${t.family}`);t=e;let s=t.family,i=!1;if(s.endsWith("v")&&s[0]<="Z"){if(t.innerLayer!==void 0||t.outerLayer!==void 0)throw new Error("Cannot use a prefix with full cube rotations");s=s.slice(0,-1),i=!0}s.endsWith("w")&&s[0]<="Z"&&(s=s.slice(0,-1).toLowerCase());let n,o=-1,r=this.swizzler.unswizzle(s),m=!1;for(let p=0;p<this.movesetgeos.length;p++){let d=this.movesetgeos[p];r===d[0]&&(m=!0,n=d,o=p),r===d[2]&&(m=!1,n=d,o=p)}let c=1,u=1;if(s.toUpperCase()!==s&&(u=2),n===void 0)throw new Error(`Bad grip in move ${t.family}`);if(t.outerLayer!==void 0&&(c=t.outerLayer),t.innerLayer!==void 0&&(t.outerLayer===void 0?(u=t.innerLayer,s<="Z"?c=u:c=1):u=t.innerLayer),c--,u--,i&&(c=0,u=this.moveplanesets[o].length),c<0||c>this.moveplanesets[o].length||u<0||u>this.moveplanesets[o].length)throw new Error(`Bad slice spec ${c} ${u} vs ${this.moveplanesets[o].length}`);if(!be&&c===0&&u===this.moveplanesets[o].length&&!i)throw new Error("! full puzzle rotations must be specified with v suffix.");return[void 0,o,c,u,m,t.amount]}parsemove(t){let e=this.parseMove(this.stringToBlockMove(t));return e[0]=t,e}genperms(){let t="genperms";if(this.cmovesbyslice.length>0)return;let e=[];if(this.options.orientCenters){for(let s=0;s<this.cubies.length;s++)if(this.cubies[s].length===1){let i=this.cubies[s][0],n=this.getfaceindex(i),o=this.basefaces[n].centermass();if(o.dist(this.facecentermass[i])<G){let r=1<<n|1<<this.baseFaceCount,m=this.markedface[r],c=this.baseplanes[m].makenormal(),u=-1,p=-1;for(let h=0;h<this.faces[i].length;h++){let a=this.faces[i].get(h),f=c.dot(a.sub(o));f>u&&(u=f,p=h)}let d=(p+1)%this.faces[i].length;if(Math.abs(c.dot(this.faces[i].get(d).sub(o))-u)<G&&(p=d),p!==0){let h=[];for(let a=0;a<this.faces[i].length;a++)h.push(this.faces[i].get((a+p)%this.faces[i].length));this.faces[i]=new at(h)}let b=this.basefaces[n].length;for(let h=1;h<b;h++)this.cubies[s].push(this.cubies[s][h-1]);this.duplicatedFaces[i]=b,this.duplicatedCubies[s]=b,this.orbitoris[this.cubiesetnums[s]]=b}}}for(let s=0;s<this.moveplanesets.length;s++){let i=this.moveplanesets[s],n=[],o=[i.length+1,0],r=1;for(;r*2<=i.length;)r*=2;for(let u=0;u<this.faces.length;u++){let p=0;if(i.length>0){let d=this.facecentermass[u].dot(i[0]);for(let b=r;b>0;b>>=1)p+b<=i.length&&d>i[p+b-1].a&&(p+=b);p=i.length-p}for(n.push(p);o.length<=p;)o.push(0);o[p]++}let m=new Array(o.length);for(let u=0;u<o.length;u++)m[u]=[];let c=[];for(let u=0;u<this.faces.length;u++){if(n[u]<0)continue;let p=[this.facetocubie[u],this.facetoord[u]],d=this.facecentermass[u],b=d,h=u,a=n[h];for(;;){n[h]=-1;let f=d.rotatepoint(this.moverotations[s][0]);if(f.dist(b)<G)break;h=this.findface(f),p.push(this.facetocubie[h],this.facetoord[h]),d=f}if(p.length>2&&this.options.orientCenters&&(this.cubies[p[0]].length===1||this.duplicatedCubies[p[0]]>1)&&this.facecentermass[u].dist(this.basefaces[this.getfaceindex(u)].centermass())<G){let f=this.faces[this.cubies[p[0]][0]];for(let v=0;v<p.length;v+=2){let F=this.faces[this.cubies[p[v]][0]],y=-1;for(let B=0;B<f.length;B++)if(F.get(B).dist(f.get(0))<G){y=B;break}if(y<0)throw new Error("Couldn't find rotation of center faces; ignoring for now.");p[v+1]=y,f=f.rotate(this.moverotations[s][0])}}if(p.length===2&&this.options.orientCenters)for(let f=1;f<this.movesetorders[s];f++)a===0?p.push(p[0],f):p.push(p[0],(this.movesetorders[s]-f)%this.movesetorders[s]);if(p.length>2&&!c[p[0]]){if(p.length!==2*this.movesetorders[s])throw new Error("Bad length in perm gen");for(let f of p)m[a].push(f)}for(let f=0;f<p.length;f+=2)c[p[f]]=!0}for(let u=0;u<m.length;u++)m[u]=m[u].slice();e.push(m)}if(this.cmovesbyslice=e,this.options.moveList){let s=[];for(let i of this.options.moveList)s.push(this.parsemove(i));this.parsedmovelist=s}this.facelisthash.clear(),this.facecentermass=[]}getboundarygeometry(){return{baseplanes:this.baseplanes,facenames:this.facenames,faceplanes:this.faceplanes,vertexnames:this.vertexnames,edgenames:this.edgenames,geonormals:this.geonormals}}getmovesets(t){let e=this.moveplanesets[t].length,s=[];if(this.parsedmovelist!==void 0)for(let i of this.parsedmovelist)i[1]===t&&(i[4]?s.push([i[2],i[3]]):s.push([e-i[3],e-i[2]]),s.push(i[5]));else if(this.options.vertexMoves&&!this.options.allMoves){let i=this.movesetgeos[t];if(i[1]!==i[3])for(let n=0;n<e;n++)i[1]!=="v"?(this.options.outerBlockMoves?s.push([n+1,e]):s.push([n+1]),s.push(1)):(this.options.outerBlockMoves?s.push([0,n]):s.push([n,n]),s.push(1))}else for(let i=0;i<=e;i++)!this.options.allMoves&&i+i===e||(this.options.outerBlockMoves?i+i>e?s.push([i,e]):s.push([0,i]):s.push([i,i]),s.push(1));if(this.fixedCubie>=0){let i=this.keyface3(this.faces[this.cubies[this.fixedCubie][0]])[t],n=[];for(let o=0;o<s.length;o+=2){let r=s[o];if(i>=r[0]&&i<=r[1])if(r[0]===0)r=[r[1]+1,e];else if(e===r[1])r=[0,r[0]-1];else throw Error("fixed cubie option would disconnect move");let m=!1;for(let c=0;c<n.length;c+=2)if(n[c][0]===r[0]&&n[c][1]===r[1]&&n[c+1]===s[o+1]){m=!0;break}m||(n.push(r),n.push(s[o+1]))}s=n}return s}graybyori(t){let e=this.cubies[t].length;return this.duplicatedCubies[t]&&(e=1),e===1&&(this.options.grayCenters||!this.options.includeCenterOrbits)||e===2&&(this.options.grayEdges||!this.options.includeEdgeOrbits)||e>2&&(this.options.grayCorners||!this.options.includeCornerOrbits)}skipbyori(t){let e=this.cubies[t].length;return this.duplicatedCubies[t]&&(e=1),e===1&&!this.options.includeCenterOrbits||e===2&&!this.options.includeEdgeOrbits||e>2&&!this.options.includeCornerOrbits}skipcubie(t){return this.skipbyori(t)}header(t){return t+ge+`
`+t+`
`}writegap(){let t=this.getOrbitsDef(!1),e=[],s=[];for(let n=0;n<t.moveops.length;n++){let o=`M_${yt(this.notationMapper,t.movenames[n])}`,r=!1;o[o.length-1]==="'"&&(o=o.substring(0,o.length-1),r=!0),s.push(o),r?e.push(`${o}:=${t.moveops[n].toPerm().inv().toGap()};`):e.push(`${o}:=${t.moveops[n].toPerm().toGap()};`)}e.push("Gen:=["),e.push(s.join(",")),e.push("];");let i=t.solved.identicalPieces();return e.push(`ip:=[${i.map(n=>`[${n.map(o=>o+1).join(",")}]`).join(",")}];`),e.push("# Size(Group(Gen));"),e.push("# Size(Stabilizer(Group(Gen), ip, OnTuplesSets));"),e.push(""),this.header("# ")+e.join(`
`)}writeksolve(t="PuzzleGeometryPuzzle"){let e=this.getOrbitsDef(!1);return this.header("# ")+e.toKsolve(t,this.notationMapper).join(`
`)}getKPuzzleDefinition(t=!0,e=!0){let i=this.getOrbitsDef(t,e).toKPuzzleDefinition(e);if(i.experimentalPuzzleDescription=this.puzzleDescription,!i)throw new Error("Missing definition!");return i}getMoveFromBits(t,e,s,i,n,o){let r=[],m=[],c=[];for(let d of this.cubieords)m.push(q(d)),c.push(nt(d));for(let d=t[0];d<=t[1];d++){let b=i[d];for(let h=0;h<b.length;h+=2*o){let a=b.slice(h,h+2*o),f=this.cubiesetnums[a[0]];for(let y=0;y<a.length;y+=2)a[y]=this.cubieordnums[a[y]];let v=2,F=3;s&&(v=a.length-2,F=a.length-1),m[f]===q(this.cubieords[f])&&(m[f]=m[f].slice(),this.orbitoris[f]>1&&!this.options.fixedOrientation&&(c[f]=c[f].slice()));for(let y=0;y<a.length;y+=2)m[f][a[(y+v)%a.length]]=a[y],this.orbitoris[f]>1&&!this.options.fixedOrientation&&(c[f][a[y]]=(a[(y+F)%a.length]-a[(y+1)%a.length]+2*this.orbitoris[f])%this.orbitoris[f])}}let u=new it(q(24),nt(24),1);for(let d=0;d<this.cubiesetnames.length;d++)if(!(n&&!n[d]))if(this.orbitoris[d]===1||this.options.fixedOrientation)m[d]===q(u.perm.length)?(m[d]!==u.perm&&(u=new it(m[d],c[d],1)),r.push(u)):r.push(new it(m[d],c[d],1));else{let b=new Array(c[d].length);for(let h=0;h<m[d].length;h++)b[h]=c[d][m[d][h]];r.push(new it(m[d],b,this.orbitoris[d]))}let p=new rt(r);return e!==1&&(p=p.mulScalar(e)),p}omitSet(t){for(let e of this.options.excludeOrbits)if(e===t)return!0;return!1}diffmvsets(t,e,s,i){for(let n=0;n<t.length;n+=2){let o=!1;for(let r=0;!o&&r<e.length;r+=2)i?t[n][0]+e[r][1]===s&&t[n][1]+e[r][0]===s&&t[n+1]===e[r+1]&&(o=!0):t[n][0]===e[r][0]&&t[n][1]===e[r][1]&&t[n+1]===e[r+1]&&(o=!0);if(!o)return!0}return!1}getOrbitsDef(t,e=!0){let s=[];if(t)for(let a=0;a<this.cubiesetnames.length;a++)s.push(1);let i=[],n=[],o=[],r=[];for(let a=0;a<this.moveplanesets.length;a++){let f=this.getmovesets(a);o.push(f),this.options.addRotations?r.push(1):r.push(0)}let m=[];for(let a=0;a<this.moveplanesets.length;a++){let f=this.moveplanesets[a].length,v=!1,F=o[a];for(let y=0;y<F.length;y+=2)F[y][0]===0&&F[y][1]===f&&(v=!0);m[a]=v}if(this.options.addRotations&&(this.options.moveList||this.options.fixedPieceType!==null)){for(let a=0;a<this.moverotations.length;a++)r[a]=0;for(let a=0;a<this.moveplanesets.length;a++){if(m[a]){r[a]=3;continue}for(let f=0;f<this.moverotations.length;f++){let v=this.moveplanenormals[a];for(let F=1;F*2<=this.movesetorders[f];F++){if(v=v.rotatepoint(this.moverotations[f][0]),r[f]&F)continue;let y=-1,B=!1;for(let $=0;$<this.moveplanenormals.length;$++)if(v.dist(this.moveplanenormals[$])<G){y=$;break}else if(v.dist(this.moveplanenormals[$].smul(-1))<G){y=$,B=!0;break}if(y<0)throw new Error("Could not find rotation");let M=o[y];(M.length!==o[a].length||this.moveplanesets[a].length!==this.moveplanesets[y].length||this.diffmvsets(M,o[a],this.moveplanesets[y].length,B))&&(r[f]|=F)}}}for(let a=0;a<this.moverotations.length;a++)if(r[a]===0)r[a]=1;else if(r[a]===1)this.movesetorders[a]>3?r[a]=2:r[a]=0;else if(r[a]===3)r[a]=0;else throw new Error("Impossible addrot val")}for(let a=0;a<this.moveplanesets.length;a++)r[a]!==0&&!m[a]&&(o[a].push([0,this.moveplanesets[a].length]),o[a].push(r[a]));for(let a=0;a<this.moveplanesets.length;a++){let f=o[a],v=this.movesetorders[a];for(let B=0;B<f.length;B+=2)for(let M=0;M<B;M+=2)if(f[B][0]===f[M][0]&&f[B][1]===f[M][1])throw new Error("Redundant moves in moveset.");let F=[];for(let B=0;B<f.length;B+=2)for(let M=f[B][0];M<=f[B][1];M++)F[M]=1;let y=this.cmovesbyslice[a];for(let B=0;B<y.length;B++){if(F[B]!==1)continue;let M=y[B];for(let $=0;$<M.length;$+=2*v){if(this.skipcubie(M[$]))continue;let Q=this.cubiesetnums[M[$]];s[Q]=1}}}for(let a=0;a<this.cubiesetnames.length;a++)if(s[a]){if(this.omitSet(this.cubiesetnames[a])){s[a]=0;continue}i.push(this.cubiesetnames[a]),n.push(new vt(this.cubieords[a],this.options.fixedOrientation?1:this.orbitoris[a]))}let c=[];for(let a=0;a<this.cubiesetnames.length;a++){if(!s[a]||this.omitSet(this.cubiesetnames[a]))continue;let f=[],v=[];for(let F=0;F<this.cubieords[a];F++){if(t)f.push(F);else{let y=this.cubiesetcubies[a][F];f.push(this.cubievaluemap[y])}v.push(0)}c.push(new it(f,v,this.options.fixedOrientation?1:this.orbitoris[a]))}let u=[],p=[],d=[],b=[];if(e)for(let a=0;a<this.moveplanesets.length;a++){let v=this.moveplanesets[a].length,F=o[a],y=this.movesetgeos[a];for(let B=0;B<F.length;B+=2){let M=F[B],$,Q=!1;if(this.parsedmovelist!==void 0)for(let C of this.parsedmovelist){if(C[1]!==a)continue;let g=[];C[4]?g=[C[2],C[3]]:g=[v-C[3],v-C[2]],g[0]===M[0]&&g[1]===M[1]&&($=C[0],Q=!C[4])}if($)u.push($),p.push(!0);else{let C=Fe(y,M,v);Q=C[1];let g=C[0];F[B+1]===1?u.push(g):u.push(g+F[B+1]),p.push(!1)}b.push(M[0]===0&&M[1]===v);let N=this.getMoveFromBits(M,F[B+1],Q,this.cmovesbyslice[a],s,this.movesetorders[a]);d.push(N)}}let h=new Lt(i,n,new Ft(c),u,d,b,p);return this.options.optimizeOrbits&&(h=h.optimize()),this.options.scrambleAmount!==0&&h.scramble(this.options.scrambleAmount),h}getScramble(t=0){let e=this.getOrbitsDef(!1);return e.transformToKTransformationData(e.getScrambleTransformation(t))}getMovesAsPerms(){return this.getOrbitsDef(!1).moveops.map(t=>t.toPerm())}showcanon(t){oe(this.getOrbitsDef(!1),t)}getsolved(){let t=[];for(let e=0;e<this.baseFaceCount;e++)for(let s=0;s<this.stickersperface;s++)t.push(e);return new tt(t)}getOrientationRotation(t){let[e,[s,i,n]]=t[0],o=new U(0,s,-i,n),[r,[m,c,u]]=t[1],p=new U(0,m,-c,u),d=null,b=null,h=this.swizzler.unswizzle(e),a=this.swizzler.unswizzle(r);for(let y of this.geonormals)h===y[1]&&(d=y[0]),a===y[1]&&(b=y[0]);if(!d)throw new Error(`Could not find feature ${e}`);if(!b)throw new Error(`Could not find feature ${r}`);let f=d.pointrotation(o);return b.rotatepoint(f).unproject(o).pointrotation(p.unproject(o)).mul(f)}getInitial3DRotation(){let t=this.baseFaceCount,e=null;if(this.options.puzzleOrientation?e=this.options.puzzleOrientation:this.options.puzzleOrientations&&(e=this.options.puzzleOrientations[t]),e||(e=xe()[t]),!e)throw new Error("No default orientation?");return this.getOrientationRotation(e)}generate2dmapping(t=800,e=500,s=10,i=!1,n=.92){t-=2*s,e-=2*s;function o(w,x){let D=w[1][0]-w[0][0],P=w[1][1]-w[0][1],O=2*Math.PI/x,A=Math.cos(O),K=Math.sin(O);for(let W=2;W<x;W++){let J=D*A+P*K;P=P*A-D*K,D=J,w.push([w[W-1][0]+D,w[W-1][1]+P])}}this.genperms();let c=this.getboundarygeometry().facenames[0][0].length,u=this.net;if(u===null)throw new Error("No net?");let p={},d=0,b=0,h=1,a=0;p[u[0][0]]=[[1,0],[0,0]],o(p[u[0][0]],c);for(let w of u){let x=w[0];if(!p[x])throw new Error("Bad edge description; first edge not connected.");for(let D=1;D<w.length;D++){let P=w[D];P===""||p[P]||(p[P]=[p[x][D%c],p[x][(D+c-1)%c]],o(p[P],c))}}for(let w in p){let x=p[w];for(let D of x)d=Math.min(d,D[0]),h=Math.max(h,D[0]),b=Math.min(b,D[1]),a=Math.max(a,D[1])}let f=Math.min(t/(h-d),e/(a-b)),v=.5*(t-f*(h+d)),F=.5*(e-f*(a+b)),y={},B=this.getboundarygeometry(),M={},$=[[f+v,F],[v,F]];M[u[0][0]]=$,o(M[u[0][0]],c),y[this.facenames[0][1]]=this.project2d(0,0,[new U(0,$[0][0],$[0][1],0),new U(0,$[1][0],$[1][1],0)]);let Q=[];Q[0]=0;for(let w of u){let x=w[0];if(!M[x])throw new Error("Bad edge description; first edge not connected.");let D=-1;for(let O=0;O<B.facenames.length;O++)if(x===B.facenames[O][1]){D=O;break}if(D<0)throw new Error(`Could not find first face name ${x}`);let P=B.facenames[D][0];for(let O=1;O<w.length;O++){let A=w[O];if(A===""||M[A])continue;M[A]=[M[x][O%c],M[x][(O+c-1)%c]],o(M[A],c);let K=Q[D],W=P[(K+O)%c].sum(P[(K+O+c-1)%c]).smul(.5),J=lt(B.edgenames,W),et=B.edgenames[J][1],H=Be(et,this.facenames),ot=H[x===H[0]?1:0],V=-1;for(let _=0;_<B.facenames.length;_++)if(ot===B.facenames[_][1]){V=_;break}if(V<0)throw new Error("Could not find second face name");let X=B.facenames[V][0];for(let _=0;_<X.length;_++)if(X[_].sum(X[(_+1)%c]).smul(.5).dist(W)<=G){let L=M[x][(O+c-1)%c],E=M[x][O%c];Q[V]=_,y[ot]=this.project2d(V,_,[new U(0,E[0],E[1],0),new U(0,L[0],L[1],0)]);break}}}let N=0,C=0,g=this.getInitial3DRotation();for(let w of this.faces){i&&(w=w.rotate(g));for(let x=0;x<w.length;x++)N=Math.max(N,Math.abs(w.get(x).b)),C=Math.max(C,Math.abs(w.get(x).c))}let z=Math.min(e/C/2,(t-s)/N/4);return(w,x)=>{if(i){x=x.rotatepoint(g);let D=.5*s+.25*t,P=this.baseplanes[w].rotateplane(g).d<0?1:-1;return[s+t*.5+P*(D-x.b*z),s+e*.5+x.c*z]}else{let D=y[this.facenames[w][1]];return[s+n*x.dot(D[0])+D[2].b,s+e-n*x.dot(D[1])-D[2].c]}}}generatesvg(t=800,e=500,s=10,i=!1){let n=this.generate2dmapping(t,e,s,i);function o(d,b,h){return`<polygon id="${d}" class="sticker" style="fill: ${h}" points="${b.map(a=>`${a[0]} ${a[1]}`).join(" ")}"/>
`}let r=this.getsolved(),m=[],c=[];for(let d=0;d<this.baseFaceCount;d++)m[d]=this.colors[this.facenames[d][1]];for(let d=0;d<this.faces.length;d++){let b=this.faces[d],h=Math.floor(d/this.stickersperface),a=[];for(let f=0;f<b.length;f++)a.push(n(h,b.get(f)));c.push(a)}let u=[];for(let d=0;d<this.baseFaceCount;d++){u.push("<g>"),u.push(`<title>${this.facenames[d][1]}</title>
`);for(let b=0;b<this.stickersperface;b++){let h=d*this.stickersperface+b,a=this.facetocubie[h],f=this.facetoord[h],v=this.cubiesetnums[a],F=this.cubieordnums[a],y=this.graybyori(a)?"#808080":m[r.p[h]],B=`${this.cubiesetnames[v]}-l${F}-o${f}`;if(u.push(o(B,c[h],y)),this.duplicatedFaces[h])for(let M=1;M<this.duplicatedFaces[h];M++)B=`${this.cubiesetnames[v]}-l${F}-o${M}`,u.push(o(B,c[h],y))}u.push("</g>")}return`<svg id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 800 500">
<style type="text/css"><![CDATA[.sticker { stroke: #000000; stroke-width: 1px; }]]></style>
${u.join("")}</svg>`}get3d(t){let e=[],s=this.getInitial3DRotation(),i=[],n=.52*this.basefaces[0].get(0).len();for(let c=0;c<this.basefaces.length;c++){let u=this.basefaces[c].rotate(s),p=this.facenames[c][1];i.push({coords:wt(u,n),name:p})}for(let c=0;c<this.faces.length;c++){let u=Math.floor(c/this.stickersperface),p=this.facetocubie[c],d=this.facetoord[c],b=this.cubiesetnums[p],h=this.cubieordnums[p],a=this.graybyori(p)?"#808080":this.colors[this.facenames[u][1]];t?.stickerColors&&(a=t.stickerColors[c]);let f=this.faces[c].rotate(s);e.push({coords:wt(f,n),color:a,orbit:this.cubiesetnames[b],ord:h,ori:d,face:u});let v=f;if(this.duplicatedFaces[c]){let F=v.length/this.duplicatedFaces[c];for(let y=1;y<this.duplicatedFaces[c];y++){for(let B=0;B<F;B++)v=v.rotateforward();e.push({coords:wt(v,n),color:a,orbit:this.cubiesetnames[b],ord:h,ori:y,face:u,isDup:!0})}}}let o=[];for(let c=0;c<this.movesetgeos.length;c++){let u=this.movesetgeos[c],p=this.movesetorders[c];for(let d of this.geonormals)u[0]===d[1]&&u[1]===d[2]&&(o.push({coordinates:ht(d[0].rotatepoint(s),1),quantumMove:new k(u[0]),order:p}),o.push({coordinates:ht(d[0].rotatepoint(s).smul(-1),1),quantumMove:new k(u[2]),order:p}))}let r=this.generate2dmapping(2880,2160,0,!1,1),m=function(){let c=s.invrot();return function(u,p){let d=new U(0,p[0]*n,-p[1]*n,p[2]*n);d=d.rotatepoint(c);let b=r(u,d);return b[0]/=2880,b[1]=1-b[1]/2160,b}}().bind(this);return{stickers:e,faces:i,axis:o,unswizzle:this.unswizzle.bind(this),notationMapper:this.notationMapper,textureMapper:{getuv:m}}}getGeoNormal(t){let e=this.getInitial3DRotation(),s=this.swizzler.unswizzle(t);for(let i of this.geonormals)if(s===i[1]){let n=ht(i[0].rotatepoint(e),1);return Math.abs(n[0])<G&&Math.abs(n[2])<G&&(n[0]=0,n[2]=1e-6),n}}getfaceindex(t){let e=this.stickersperface;return Math.floor(t/e)}textForTwizzleExplorer(){return`Faces ${this.baseplanerot.length}
Stickers per face ${this.stickersperface}
Short edge ${this.shortedge}
Cubies ${this.cubies.length}
Edge distance ${this.edgedistance}
Vertex distance ${this.vertexdistance}`}writeSchreierSims(t){let s=this.getOrbitsDef(!1).reassemblySize();t(`Reassembly size is ${s}`);let i=me(this.getMovesAsPerms(),t),n=s/i;t(`Ratio is ${n}`)}},Ue=class{constructor(t,e){this.pg=t,this.orbitNames=e.orbitnames}lookupMove(t){let e=this.pg.parseMove(t);if(this.pg.parsedmovelist){let o=!1;for(let r of this.pg.parsedmovelist)r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&(o=!0);if(!o)return null}let s=[e[2],e[3]];if(!e[4]){let o=this.pg.moveplanesets[e[1]].length;s=[o-e[3],o-e[2]]}let i=this.pg.getMoveFromBits(s,e[5],!e[4],this.pg.cmovesbyslice[e[1]],void 0,this.pg.movesetorders[e[1]]);return Lt.transformToKTransformationData(this.orbitNames,i)}};export{Ee as EXPERIMENTAL_PUZZLE_BASE_SHAPES,je as EXPERIMENTAL_PUZZLE_CUT_TYPES,Ue as ExperimentalPGNotation,Me as PuzzleGeometry,U as Quat,ke as getPG3DNamedPuzzles,De as getPuzzleDescriptionString,Le as getPuzzleGeometryByDesc,Ce as getPuzzleGeometryByName,Re as parseOptions,Nt as parsePuzzleDescription,me as schreierSims};
//# sourceMappingURL=puzzle-geometry-2RB7OGB5.js.map
