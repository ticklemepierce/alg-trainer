import{f as Z,g as D,i as ge,k as Se,m as C}from"./chunk-Y4VXBZMG.js";function re(e,t,r){let i={};for(let n in e.orbits){let a=e.orbits[n],s=t[n],o=r[n];if(Q(a.numOrientations,o))i[n]=s;else if(Q(a.numOrientations,s))i[n]=o;else{let l=new Array(a.numPieces);if(a.numOrientations===1){for(let u=0;u<a.numPieces;u++)l[u]=s.permutation[o.permutation[u]];i[n]={permutation:l,orientation:s.orientation}}else{let u=new Array(a.numPieces);for(let c=0;c<a.numPieces;c++)u[c]=(s.orientation[o.permutation[c]]+o.orientation[c])%a.numOrientations,l[c]=s.permutation[o.permutation[c]];i[n]={permutation:l,orientation:u}}}}return i}function we(e,t,r){let i={};for(let n in e.orbits){let a=e.orbits[n],s=t[n],o=r[n];if(Q(a.numOrientations,o))i[n]=s;else{let l=new Array(a.numPieces);if(a.numOrientations===1){for(let u=0;u<a.numPieces;u++)l[u]=s.pieces[o.permutation[u]];i[n]={pieces:l,orientation:s.orientation}}else{let u=new Array(a.numPieces);for(let c=0;c<a.numPieces;c++)u[c]=(s.orientation[o.permutation[c]]+o.orientation[c])%a.numOrientations,l[c]=s.pieces[o.permutation[c]];i[n]={pieces:l,orientation:u}}}}return i}var be=!1,ye=new Map;function Je(e){let t=ye.get(e);if(t)return t;let r=new Array(e),i=new Array(e);for(let a=0;a<e;a++)r[a]=a,i[a]=0;let n={permutation:r,orientation:i};return be&&(Object.freeze(r),Object.freeze(i),Object.freeze(n)),ye.set(e,n),n}function Ze(e){let t={};for(let[r,i]of Object.entries(e.orbits))t[r]=Je(i.numPieces);return be&&Object.freeze(t),t}function Qe(e,t){let r=t.quantum.toString(),i=e.definition.moves[r];if(!i){let s=e.definition.experimentalDerivedMoves?.[r];s&&(i=e.algToTransformation(s).transformationData)}if(i)return O(e,i,t.amount);let n=e.definition.moves[t.toString()];if(n)return n;let a=e.definition.moves[t.invert().toString()];if(a)return O(e,a,-1);throw new Error(`Invalid move for KPuzzle (${e.name()}): ${t}`)}var T=class{constructor(e,t){this.kpuzzle=e,this.stateData=t}toJSON(){return{experimentalPuzzleName:this.kpuzzle.name(),stateData:this.stateData}}static fromTransformation(e){let t=we(e.kpuzzle.definition,e.kpuzzle.definition.startStateData,e.transformationData);return new T(e.kpuzzle,t)}apply(e){return this.applyTransformation(this.kpuzzle.toTransformation(e))}applyTransformation(e){if(e.isIdentityTransformation())return new T(this.kpuzzle,this.stateData);let t=we(this.kpuzzle.definition,this.stateData,e.transformationData);return new T(this.kpuzzle,t)}applyMove(e){return this.applyTransformation(this.kpuzzle.moveToTransformation(e))}applyAlg(e){return this.applyTransformation(this.kpuzzle.algToTransformation(e))}experimentalToTransformation(){if(!this.kpuzzle.canConvertStateToUniqueTransformation())return null;let e={};for(let[t,r]of Object.entries(this.stateData)){let i={permutation:r.pieces,orientation:r.orientation};e[t]=i}return new w(this.kpuzzle,e)}experimentalIsSolved(e){if(!this.kpuzzle.definition.experimentalIsStateSolved)throw new Error("`KState.experimentalIsSolved()` is not supported for this puzzle at the moment.");return this.kpuzzle.definition.experimentalIsStateSolved(this,e)}},w=class{constructor(e,t){this.kpuzzle=e,this.transformationData=t}toJSON(){return{experimentalPuzzleName:this.kpuzzle.name(),transformationData:this.transformationData}}invert(){return new w(this.kpuzzle,ze(this.kpuzzle,this.transformationData))}#e;isIdentityTransformation(){return this.#e??(this.#e=this.isIdentical(this.kpuzzle.identityTransformation()))}static experimentalConstructIdentity(e){let t=new w(e,Ze(e.definition));return t.#e=!0,t}isIdentical(e){return tt(this.kpuzzle,this.transformationData,e.transformationData)}apply(e){return this.applyTransformation(this.kpuzzle.toTransformation(e))}applyTransformation(e){if(this.kpuzzle!==e.kpuzzle)throw new Error(`Tried to apply a transformation for a KPuzzle (${e.kpuzzle.name()}) to a different KPuzzle (${this.kpuzzle.name()}).`);return this.#e?new w(this.kpuzzle,e.transformationData):e.#e?new w(this.kpuzzle,this.transformationData):new w(this.kpuzzle,re(this.kpuzzle.definition,this.transformationData,e.transformationData))}applyMove(e){return this.applyTransformation(this.kpuzzle.moveToTransformation(e))}applyAlg(e){return this.applyTransformation(this.kpuzzle.algToTransformation(e))}toKState(){return T.fromTransformation(this)}repetitionOrder(){return rt(this.kpuzzle.definition,this)}selfMultiply(e){return new w(this.kpuzzle,O(this.kpuzzle,this.transformationData,e))}};function Q(e,t){let{permutation:r}=t,i=r.length;for(let n=0;n<i;n++)if(r[n]!==n)return!1;if(e>1){let{orientation:n}=t;for(let a=0;a<i;a++)if(n[a]!==0)return!1}return!0}function et(e,t,r,i={}){for(let n=0;n<e.numPieces;n++)if(!i?.ignoreOrientation&&t.orientation[n]!==r.orientation[n]||!i?.ignorePermutation&&t.permutation[n]!==r.permutation[n])return!1;return!0}function tt(e,t,r){for(let[i,n]of Object.entries(e.definition.orbits))if(!et(n,t[i],r[i]))return!1;return!0}function ze(e,t){let r={};for(let i in e.definition.orbits){let n=e.definition.orbits[i],a=t[i];if(Q(n.numOrientations,a))r[i]=a;else if(n.numOrientations===1){let s=new Array(n.numPieces);for(let o=0;o<n.numPieces;o++)s[a.permutation[o]]=o;r[i]={permutation:s,orientation:a.orientation}}else{let s=new Array(n.numPieces),o=new Array(n.numPieces);for(let l=0;l<n.numPieces;l++){let u=a.permutation[l];s[u]=l,o[u]=(n.numOrientations-a.orientation[l]+n.numOrientations)%n.numOrientations}r[i]={permutation:s,orientation:o}}}return r}function O(e,t,r){if(r===1)return t;if(r<0)return O(e,ze(e,t),-r);if(r===0){let{transformationData:a}=e.identityTransformation();return a}let i=t;r!==2&&(i=O(e,t,Math.floor(r/2)));let n=re(e.definition,i,i);return r%2===0?n:re(e.definition,t,n)}var nt=class extends ge{traverseAlg(e,t){let r=null;for(let i of e.childAlgNodes())r?r=r.applyTransformation(this.traverseAlgNode(i,t)):r=this.traverseAlgNode(i,t);return r??t.identityTransformation()}traverseGrouping(e,t){let r=this.traverseAlg(e.alg,t);return new w(t,O(t,r.transformationData,e.amount))}traverseMove(e,t){return t.moveToTransformation(e)}traverseCommutator(e,t){let r=this.traverseAlg(e.A,t),i=this.traverseAlg(e.B,t);return r.applyTransformation(i).applyTransformation(r.invert()).applyTransformation(i.invert())}traverseConjugate(e,t){let r=this.traverseAlg(e.A,t),i=this.traverseAlg(e.B,t);return r.applyTransformation(i).applyTransformation(r.invert())}traversePause(e,t){return t.identityTransformation()}traverseNewline(e,t){return t.identityTransformation()}traverseLineComment(e,t){return t.identityTransformation()}},it=Se(nt);function ae(e,t){return t?ae(t,e%t):e}function rt(e,t){let r=1;for(let i in e.orbits){let n=e.orbits[i],a=t.transformationData[i],s=new Array(n.numPieces);for(let o=0;o<n.numPieces;o++)if(!s[o]){let l=o,u=0,c=0;for(;s[l]=!0,u=u+a.orientation[l],c=c+1,l=a.permutation[l],l!==o;);u!==0&&(c=c*n.numOrientations/ae(n.numOrientations,Math.abs(u))),r=r*c/ae(r,c)}}return r}var b=class{constructor(e,t){this.definition=e,this.#e=new Map,this.experimentalPGNotation=t?.experimentalPGNotation}name(){return this.definition.name}identityTransformation(){return w.experimentalConstructIdentity(this)}#e;moveToTransformation(e){typeof e=="string"&&(e=new D(e));let t=e.toString(),r=this.#e.get(t);if(r)return new w(this,r);if(this.experimentalPGNotation){let n=this.experimentalPGNotation.lookupMove(e);if(!n)throw new Error(`could not map to internal move: ${e}`);return this.#e.set(t,n),new w(this,n)}let i=Qe(this,e);return this.#e.set(t,i),new w(this,i)}algToTransformation(e){return typeof e=="string"&&(e=new C(e)),it(e,this)}toTransformation(e){return typeof e=="string"?this.algToTransformation(e):e?.is?.(C)?this.algToTransformation(e):e?.is?.(D)?this.moveToTransformation(e):e}startState(){return new T(this,this.definition.startStateData)}#t;canConvertStateToUniqueTransformation(){return this.#t??(this.#t=(()=>{for(let[e,t]of Object.entries(this.definition.orbits)){let r=new Array(t.numPieces).fill(!1);for(let i of this.definition.startStateData[e].pieces)r[i]=!0;for(let i of r)if(!i)return!1}return!0})())}};function dn(e,t,r,i,n){let s=e.orbits[t].pieces[r];if(s===null)return y;let o=s.facelets?.[i];return o===null?y:typeof o=="string"?o:n?o.hintMask??o.mask:(console.log(o),o.mask)}var P=class{constructor(e,t){this.stickerings=new Map;for(let[r,i]of Object.entries(e.definition.orbits))this.stickerings.set(r,new Array(i.numPieces).fill(t))}},y="regular",v="ignored",N="oriented",K="invisible",R="dim",at={Regular:{facelets:[y,y,y,y,y]},Ignored:{facelets:[v,v,v,v,v]},OrientationStickers:{facelets:[N,N,N,N,N]},IgnoreNonPrimary:{facelets:[y,v,v,v,v]},Invisible:{facelets:[K,K,K,K,K]},PermuteNonPrimary:{facelets:[R,y,y,y,y]},Dim:{facelets:[R,R,R,R,R]},Ignoriented:{facelets:[R,v,v,v,v]},OrientationWithoutPermutation:{facelets:[N,v,v,v,v]}};function st(e){return at[e]}var oe=class extends P{constructor(e){super(e,"Regular")}set(e,t){for(let[r,i]of this.stickerings.entries())for(let n=0;n<i.length;n++)e.stickerings.get(r)[n]&&(i[n]=t);return this}toStickeringMask(){let e={orbits:{}};for(let[t,r]of this.stickerings.entries()){let i=[],n={pieces:i};e.orbits[t]=n;for(let a of r)i.push(st(a))}return e}},ce=class{constructor(e){this.kpuzzle=e}and(e){let t=new P(this.kpuzzle,!1);for(let[r,i]of Object.entries(this.kpuzzle.definition.orbits)){e:for(let n=0;n<i.numPieces;n++){t.stickerings.get(r)[n]=!0;for(let a of e)if(!a.stickerings.get(r)[n]){t.stickerings.get(r)[n]=!1;continue e}}}return t}or(e){let t=new P(this.kpuzzle,!1);for(let[r,i]of Object.entries(this.kpuzzle.definition.orbits)){e:for(let n=0;n<i.numPieces;n++){t.stickerings.get(r)[n]=!1;for(let a of e)if(a.stickerings.get(r)[n]){t.stickerings.get(r)[n]=!0;continue e}}}return t}not(e){let t=new P(this.kpuzzle,!1);for(let[r,i]of Object.entries(this.kpuzzle.definition.orbits))for(let n=0;n<i.numPieces;n++)t.stickerings.get(r)[n]=!e.stickerings.get(r)[n];return t}all(){return this.and(this.moves([]))}move(e){let t=this.kpuzzle.moveToTransformation(e),r=new P(this.kpuzzle,!1);for(let[i,n]of Object.entries(this.kpuzzle.definition.orbits))for(let a=0;a<n.numPieces;a++)(t.transformationData[i].permutation[a]!==a||t.transformationData[i].orientation[a]!==0)&&(r.stickerings.get(i)[a]=!0);return r}moves(e){return e.map(t=>this.move(t))}orbits(e){let t=new P(this.kpuzzle,!1);for(let r of e)t.stickerings.get(r).fill(!0);return t}orbitPrefix(e){let t=new P(this.kpuzzle,!1);for(let r in this.kpuzzle.definition.orbits)r.startsWith(e)&&t.stickerings.get(r).fill(!0);return t}},De="Last Layer",ke="Last Slot",z={"3x3x3":De,megaminx:De},M={"3x3x3":ke,megaminx:ke},ot={full:{groups:{"3x3x3":"Stickering",megaminx:"Stickering"}},OLL:{groups:z},PLL:{groups:z},LL:{groups:z},EOLL:{groups:z},COLL:{groups:z},OCLL:{groups:z},CPLL:{groups:z},CLL:{groups:z},EPLL:{groups:z},ELL:{groups:z},ZBLL:{groups:z},LS:{groups:M},ELS:{groups:M},CLS:{groups:M},ZBLS:{groups:M},VLS:{groups:M},WVLS:{groups:M},F2L:{groups:{"3x3x3":"CFOP (Fridrich)"}},Daisy:{groups:{"3x3x3":"CFOP (Fridrich)"}},Cross:{groups:{"3x3x3":"CFOP (Fridrich)"}},EO:{groups:{"3x3x3":"ZZ"}},EOline:{groups:{"3x3x3":"ZZ"}},EOcross:{groups:{"3x3x3":"ZZ"}},CMLL:{groups:{"3x3x3":"Roux"}},L10P:{groups:{"3x3x3":"Roux"}},L6E:{groups:{"3x3x3":"Roux"}},L6EO:{groups:{"3x3x3":"Roux"}},"2x2x2":{groups:{"3x3x3":"Petrus"}},"2x2x3":{groups:{"3x3x3":"Petrus"}},L2C:{groups:{"4x4x4":"Reduction","5x5x5":"Reduction","6x6x6":"Reduction"}},PBL:{groups:{"2x2x2":"Ortega"}},"Void Cube":{groups:{"3x3x3":"Miscellaneous"}},invisible:{groups:{"3x3x3":"Miscellaneous"}},picture:{groups:{"3x3x3":"Miscellaneous"}},"centers-only":{groups:{"3x3x3":"Miscellaneous"}},"experimental-centers-U":{},"experimental-centers-U-D":{},"experimental-centers-U-L-D":{},"experimental-centers-U-L-B-D":{},"experimental-centers":{},"experimental-fto-fc":{groups:{fto:"Bencisco"}},"experimental-fto-f2t":{groups:{fto:"Bencisco"}},"experimental-fto-sc":{groups:{fto:"Bencisco"}},"experimental-fto-l2c":{groups:{fto:"Bencisco"}},"experimental-fto-lbt":{groups:{fto:"Bencisco"}},"experimental-fto-l3t":{groups:{fto:"Bencisco"}}};async function F(e,t){let r=await e.kpuzzle(),i=new oe(r),n=new ce(r),a=()=>n.move("U"),s=()=>n.or(n.moves(["U","D"])),o=()=>n.or(n.moves(["L","R"])),l=()=>n.not(o()),u=()=>n.not(a()),c=()=>n.orbitPrefix("CENTER"),p=()=>n.orbitPrefix("EDGE"),m=()=>n.or([n.orbitPrefix("CORNER"),n.orbitPrefix("C4RNER"),n.orbitPrefix("C5RNER")]),S=()=>n.or([l(),n.and([a(),p()])]),d=()=>n.and([a(),c()]),k=()=>n.and([n.and(n.moves(["F","R"])),p()]),ie=()=>n.and([n.and(n.moves(["F","R"])),m(),n.not(a())]),J=()=>n.or([ie(),k()]);function x(){i.set(u(),"Dim")}function Xe(){i.set(a(),"PermuteNonPrimary"),i.set(d(),"Dim")}function V(){i.set(a(),"IgnoreNonPrimary"),i.set(d(),"Regular")}function $e(){i.set(a(),"Ignoriented"),i.set(d(),"Dim")}switch(t){case"full":break;case"PLL":{x(),Xe();break}case"CLS":{x(),i.set(ie(),"Regular"),i.set(a(),"Ignoriented"),i.set(n.and([a(),c()]),"Dim"),i.set(n.and([a(),m()]),"IgnoreNonPrimary");break}case"OLL":{x(),V();break}case"EOLL":{x(),V(),i.set(n.and([a(),m()]),"Ignored");break}case"COLL":{x(),i.set(n.and([a(),p()]),"Ignoriented"),i.set(n.and([a(),c()]),"Dim"),i.set(n.and([a(),m()]),"Regular");break}case"OCLL":{x(),$e(),i.set(n.and([a(),m()]),"IgnoreNonPrimary");break}case"CPLL":{x(),i.set(n.and([m(),a()]),"PermuteNonPrimary"),i.set(n.and([n.not(m()),a()]),"Dim");break}case"CLL":{x(),i.set(n.not(n.and([m(),a()])),"Dim");break}case"EPLL":{x(),i.set(a(),"Dim"),i.set(n.and([a(),p()]),"PermuteNonPrimary");break}case"ELL":{x(),i.set(a(),"Dim"),i.set(n.and([a(),p()]),"Regular");break}case"ELS":{x(),V(),i.set(n.and([a(),m()]),"Ignored"),i.set(k(),"Regular"),i.set(ie(),"Ignored");break}case"LL":{x();break}case"F2L":{i.set(a(),"Ignored");break}case"ZBLL":{x(),i.set(a(),"PermuteNonPrimary"),i.set(d(),"Dim"),i.set(n.and([a(),m()]),"Regular");break}case"ZBLS":{x(),i.set(J(),"Regular"),V(),i.set(n.and([a(),m()]),"Ignored");break}case"VLS":{x(),i.set(J(),"Regular"),V();break}case"WVLS":{x(),i.set(J(),"Regular"),i.set(n.and([a(),p()]),"Ignoriented"),i.set(n.and([a(),c()]),"Dim"),i.set(n.and([a(),m()]),"IgnoreNonPrimary");break}case"LS":{x(),i.set(J(),"Regular"),i.set(a(),"Ignored"),i.set(d(),"Dim");break}case"EO":{i.set(m(),"Ignored"),i.set(p(),"OrientationWithoutPermutation");break}case"EOline":{i.set(m(),"Ignored"),i.set(p(),"OrientationWithoutPermutation"),i.set(n.and(n.moves(["D","M"])),"Regular");break}case"EOcross":{i.set(p(),"OrientationWithoutPermutation"),i.set(n.move("D"),"Regular"),i.set(m(),"Ignored");break}case"CMLL":{i.set(u(),"Dim"),i.set(S(),"Ignored"),i.set(n.and([a(),m()]),"Regular");break}case"L10P":{i.set(n.not(S()),"Dim"),i.set(n.and([m(),a()]),"Regular");break}case"L6E":{i.set(n.not(S()),"Dim");break}case"L6EO":{i.set(n.not(S()),"Dim"),i.set(S(),"OrientationWithoutPermutation"),i.set(n.and([c(),s()]),"OrientationStickers");break}case"Daisy":{i.set(n.all(),"Ignored"),i.set(c(),"Dim"),i.set(n.and([n.move("D"),c()]),"Regular"),i.set(n.and([n.move("U"),p()]),"IgnoreNonPrimary");break}case"Cross":{i.set(n.all(),"Ignored"),i.set(c(),"Dim"),i.set(n.and([n.move("D"),c()]),"Regular"),i.set(n.and([n.move("D"),p()]),"Regular");break}case"2x2x2":{i.set(n.or(n.moves(["U","F","R"])),"Ignored"),i.set(n.and([n.or(n.moves(["U","F","R"])),c()]),"Dim");break}case"2x2x3":{i.set(n.all(),"Dim"),i.set(n.or(n.moves(["U","F","R"])),"Ignored"),i.set(n.and([n.or(n.moves(["U","F","R"])),c()]),"Dim"),i.set(n.and([n.move("F"),n.not(n.or(n.moves(["U","R"])))]),"Regular");break}case"L2C":{i.set(n.or(n.moves(["L","R","B","D"])),"Dim"),i.set(n.not(c()),"Ignored");break}case"PBL":{i.set(n.all(),"Ignored"),i.set(n.or(n.moves(["U","D"])),"PermuteNonPrimary");break}case"Void Cube":{i.set(c(),"Invisible");break}case"picture":case"invisible":{i.set(n.all(),"Invisible");break}case"centers-only":{i.set(n.not(c()),"Ignored");break}default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),i.set(n.and(n.moves([])),"Dim")}return i.toStickeringMask()}async function H(e,t){let r=[],i=[];for(let[n,a]of Object.entries(ot))a.groups&&(e in a.groups?r.push(n):t?.use3x3x3Fallbacks&&"3x3x3"in a.groups&&i.push(n));return r.concat(i)}function f(e){let t=null;return()=>t??(t=e())}var Y=class extends Promise{constructor(e){super(t=>{t()}),this._executor=e}static from(e){return new Y(t=>{t(e())})}static resolve(e){return new Y(t=>{t(e)})}static reject(e){return new Y((t,r)=>{r(e)})}then(e,t){return this._promise=this._promise||new Promise(this._executor),this._promise.then(e,t)}catch(e){return this._promise=this._promise||new Promise(this._executor),this._promise.catch(e)}};function W(e){return new Y(t=>{t(e())})}async function j(e){return(await import("./puzzle-geometry-N6WBCTL4.js")).getPuzzleGeometryByName(e,{allMoves:!0,orientCenters:!0,addRotations:!0})}async function ct(e,t){let r=await e,i=r.getKPuzzleDefinition(!0);i.name=t;let n=await import("./puzzle-geometry-N6WBCTL4.js"),a=new n.ExperimentalPGNotation(r,r.getOrbitsDef(!0));return new b(i,{experimentalPGNotation:a})}var E=class{constructor(e){this.puzzleSpecificSimplifyOptionsPromise=Te(this.kpuzzle.bind(this)),this.pgId=e.pgID,this.id=e.id,this.fullName=e.fullName,this.inventedBy=e.inventedBy,this.inventionYear=e.inventionYear}#e;pg(){return this.#e??(this.#e=j(this.pgId??this.id))}#t;kpuzzle(){return this.#t??(this.#t=ct(this.pg(),this.id))}#n;svg(){return this.#n??(this.#n=(async()=>(await this.pg()).generatesvg())())}},A=class extends E{constructor(){super(...arguments),this.stickerings=()=>H(this.id,{use3x3x3Fallbacks:!0})}stickeringMask(e){return F(this,e)}};function Te(e){return new Y(async t=>{let r=await e();t({quantumMoveOrder:i=>r.moveToTransformation(new D(i)).repetitionOrder()})})}var le={name:"3x3x3",orbits:{EDGES:{numPieces:12,numOrientations:2},CORNERS:{numPieces:8,numOrientations:3},CENTERS:{numPieces:6,numOrientations:4}},startStateData:{EDGES:{pieces:[0,1,2,3,4,5,6,7,8,9,10,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{pieces:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{pieces:[0,1,2,3,4,5],orientation:[0,0,0,0,0,0]}},moves:{U:{EDGES:{permutation:[1,2,3,0,4,5,6,7,8,9,10,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[1,2,3,0,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[1,0,0,0,0,0]}},y:{EDGES:{permutation:[1,2,3,0,5,6,7,4,10,8,11,9],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[1,2,3,0,7,4,5,6],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,2,3,4,1,5],orientation:[1,0,0,0,0,3]}},x:{EDGES:{permutation:[4,8,0,9,6,10,2,11,5,7,1,3],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[4,0,3,5,7,6,2,1],orientation:[2,1,2,1,1,2,1,2]},CENTERS:{permutation:[2,1,5,3,0,4],orientation:[0,3,0,1,2,2]}},L:{EDGES:{permutation:[0,1,2,11,4,5,6,9,8,3,10,7],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[0,1,6,2,4,3,5,7],orientation:[0,0,2,1,0,2,1,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,1,0,0,0,0]}},F:{EDGES:{permutation:[9,1,2,3,8,5,6,7,0,4,10,11],orientation:[1,0,0,0,1,0,0,0,1,1,0,0]},CORNERS:{permutation:[3,1,2,5,0,4,6,7],orientation:[1,0,0,2,2,1,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,0,1,0,0,0]}},R:{EDGES:{permutation:[0,8,2,3,4,10,6,7,5,9,1,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[4,0,2,3,7,5,6,1],orientation:[2,1,0,0,1,0,0,2]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,0,0,1,0,0]}},B:{EDGES:{permutation:[0,1,10,3,4,5,11,7,8,9,6,2],orientation:[0,0,1,0,0,0,1,0,0,0,1,1]},CORNERS:{permutation:[0,7,1,3,4,5,2,6],orientation:[0,2,1,0,0,0,2,1]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,0,0,0,1,0]}},D:{EDGES:{permutation:[0,1,2,3,7,4,5,6,8,9,10,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,5,6,7,4],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientation:[0,0,0,0,0,1]}},z:{EDGES:{permutation:[9,3,11,7,8,1,10,5,0,4,2,6],orientation:[1,1,1,1,1,1,1,1,1,1,1,1]},CORNERS:{permutation:[3,2,6,5,0,4,7,1],orientation:[1,2,1,2,2,1,2,1]},CENTERS:{permutation:[1,5,2,0,4,3],orientation:[1,1,1,1,3,1]}},M:{EDGES:{permutation:[2,1,6,3,0,5,4,7,8,9,10,11],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[4,1,0,3,5,2],orientation:[2,0,0,0,2,0]}},E:{EDGES:{permutation:[0,1,2,3,4,5,6,7,9,11,8,10],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientation:[0,0,0,0,0,0]}},S:{EDGES:{permutation:[0,3,2,7,4,1,6,5,8,9,10,11],orientation:[0,1,0,1,0,1,0,1,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[1,5,2,0,4,3],orientation:[1,1,0,1,0,1]}},u:{EDGES:{permutation:[1,2,3,0,4,5,6,7,10,8,11,9],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[1,2,3,0,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,2,3,4,1,5],orientation:[1,0,0,0,0,0]}},l:{EDGES:{permutation:[2,1,6,11,0,5,4,9,8,3,10,7],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[0,1,6,2,4,3,5,7],orientation:[0,0,2,1,0,2,1,0]},CENTERS:{permutation:[4,1,0,3,5,2],orientation:[2,1,0,0,2,0]}},f:{EDGES:{permutation:[9,3,2,7,8,1,6,5,0,4,10,11],orientation:[1,1,0,1,1,1,0,1,1,1,0,0]},CORNERS:{permutation:[3,1,2,5,0,4,6,7],orientation:[1,0,0,2,2,1,0,0]},CENTERS:{permutation:[1,5,2,0,4,3],orientation:[1,1,1,1,0,1]}},r:{EDGES:{permutation:[4,8,0,3,6,10,2,7,5,9,1,11],orientation:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[4,0,2,3,7,5,6,1],orientation:[2,1,0,0,1,0,0,2]},CENTERS:{permutation:[2,1,5,3,0,4],orientation:[0,0,0,1,2,2]}},b:{EDGES:{permutation:[0,5,10,1,4,7,11,3,8,9,6,2],orientation:[0,1,1,1,0,1,1,1,0,0,1,1]},CORNERS:{permutation:[0,7,1,3,4,5,2,6],orientation:[0,2,1,0,0,0,2,1]},CENTERS:{permutation:[3,0,2,5,4,1],orientation:[3,3,0,3,1,3]}},d:{EDGES:{permutation:[0,1,2,3,7,4,5,6,9,11,8,10],orientation:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[0,1,2,3,5,6,7,4],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientation:[0,0,0,0,0,1]}}}};le.experimentalDerivedMoves={Uw:"u",Lw:"l",Fw:"f",Rw:"r",Bw:"b",Dw:"d",Uv:"y",Lv:"x'",Fv:"z",Rv:"x",Bv:"z'",Dv:"y'","2U":"u U'","2L":"l L'","2F":"f F'","2R":"r R'","2B":"b B'","2D":"d D'"};async function fn(e){let t=await(e.puzzleSpecificSimplifyOptions??e.puzzleSpecificSimplifyOptionsPromise);return t?{puzzleLoader:{puzzleSpecificSimplifyOptions:t}}:{}}var hn=new Array(24);async function se(e){return(await import("./puzzle-geometry-N6WBCTL4.js")).getPuzzleGeometryByDesc(e,{allMoves:!0,orientCenters:!0,addRotations:!0})}async function lt(e){let t=await se(e),r=t.getKPuzzleDefinition(!0);r.name=`description: ${e}`;let i=await import("./puzzle-geometry-N6WBCTL4.js"),n=new i.ExperimentalPGNotation(t,t.getOrbitsDef(!0));return new b(r,{experimentalPGNotation:n})}var ut=1;function pn(e,t){let r=ut++,i=null,n=async()=>i??(i=lt(e)),a={id:`custom-${r}`,fullName:t?.fullName??`Custom Puzzle (instance #${r})`,kpuzzle:n,svg:async()=>(await se(e)).generatesvg(),pg:async()=>se(e),puzzleSpecificSimplifyOptionsPromise:Te(n)};return t?.inventedBy&&(a.inventedBy=t.inventedBy),t?.inventionYear&&(a.inventionYear=t.inventionYear),a}var ue=new b(le);le.experimentalIsStateSolved=ht;function Re(e){let t=e.stateData.CENTERS.pieces[0],r=e.stateData.CENTERS.pieces[5],i=e.stateData.CENTERS.pieces[1],n=i;return t<i&&n--,r<i&&n--,[t,n]}var Ee=new Array(6).fill(0).map(()=>new Array(6)),mt=!1;function dt(){if(!mt){let e=["","z","x","z'","x'","x2"].map(r=>C.fromString(r)),t=new C("y");for(let r of e){let i=ue.algToTransformation(r);for(let n=0;n<4;n++){i=i.applyAlg(t);let[a,s]=Re(i.toKState());Ee[a][s]=i.invert()}}}return Ee}function ft(e){let[t,r]=Re(e),i=dt()[t][r];return e.applyTransformation(i)}function ht(e,t){return t.ignorePuzzleOrientation&&(e=ft(e)),t.ignoreCenterOrientation&&(e=new T(e.kpuzzle,{EDGES:e.stateData.EDGES,CORNERS:e.stateData.CORNERS,CENTERS:{pieces:e.stateData.CENTERS.pieces,orientation:new Array(6).fill(0)}})),!!e.experimentalToTransformation()?.isIdentityTransformation()}var pt={333:{puzzleID:"3x3x3",eventName:"3x3x3 Cube"},222:{puzzleID:"2x2x2",eventName:"2x2x2 Cube"},444:{puzzleID:"4x4x4",eventName:"4x4x4 Cube"},555:{puzzleID:"5x5x5",eventName:"5x5x5 Cube"},666:{puzzleID:"6x6x6",eventName:"6x6x6 Cube"},777:{puzzleID:"7x7x7",eventName:"7x7x7 Cube"},"333bf":{puzzleID:"3x3x3",eventName:"3x3x3 Blindfolded"},"333fm":{puzzleID:"3x3x3",eventName:"3x3x3 Fewest Moves"},"333oh":{puzzleID:"3x3x3",eventName:"3x3x3 One-Handed"},clock:{puzzleID:"clock",eventName:"Clock"},minx:{puzzleID:"megaminx",eventName:"Megaminx"},pyram:{puzzleID:"pyraminx",eventName:"Pyraminx"},skewb:{puzzleID:"skewb",eventName:"Skewb"},sq1:{puzzleID:"square1",eventName:"Square-1"},"444bf":{puzzleID:"4x4x4",eventName:"4x4x4 Blindfolded"},"555bf":{puzzleID:"5x5x5",eventName:"5x5x5 Blindfolded"},"333mb":{puzzleID:"3x3x3",eventName:"3x3x3 Multi-Blind"}};var En={...pt,fto:{puzzleID:"fto",eventName:"Face-Turning Octahedron"},master_tetraminx:{puzzleID:"master_tetraminx",eventName:"Master Tetraminx"},kilominx:{puzzleID:"kilominx",eventName:"Kilominx"},redi_cube:{puzzleID:"redi_cube",eventName:"Redi Cube"}};var Ie={id:"2x2x2",fullName:"2\xD72\xD72 Cube",kpuzzle:f(async()=>new b((await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).cube2x2x2JSON)),svg:async()=>(await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).cube2x2x2SVG,llSVG:f(async()=>(await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).cube2x2x2LLSVG),pg:f(async()=>j("2x2x2")),stickeringMask:e=>F(Ie,e),stickerings:()=>H("2x2x2",{use3x3x3Fallbacks:!0})};function h(e,t,r,i){let n=[];for(let a of e){let s=D.fromString(a),{family:o,amount:l}=s;if(![-1,1].includes(l))throw new Error("Invalid config move");n.push({family:o,direction:l,type:t,from:r,to:i})}return n}var L={["x axis"]:{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...h(["R"],0,0,3),...h(["L'"],1,0,3),...h(["r","Rw"],2,0,2),...h(["l'","Lw'"],3,0,2),...h(["M'"],4,1,2),...h(["x","Uv","Dv'"],5,0,3)]},["y axis"]:{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...h(["U"],0,0,3),...h(["D'"],1,0,3),...h(["u","Uw"],2,0,2),...h(["d'","Dw'"],3,0,2),...h(["E'"],4,1,2),...h(["y","Uv","Dv'"],5,0,3)]},["z axis"]:{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...h(["F"],0,0,3),...h(["B'"],1,0,3),...h(["f","Fw"],2,0,3),...h(["b'","Bw'"],3,0,3),...h(["S"],4,1,2),...h(["z","Fv","Bv'"],5,0,3)]}},q={};for(let[e,t]of Object.entries(L))for(let r of t.moveSourceInfos)q[r.family]={axis:e,moveSourceInfo:r};var Ce={},Pe;for(let e of Object.keys(L)){let t={};Ce[e]=t;for(let r of L[e].moveSourceInfos)(t[Pe=r.type]??(t[Pe]=[])).push(r)}var Oe={};for(let e of Object.keys(L)){let t=new Map;Oe[e]=t;for(let r of L[e].moveSourceInfos)t.get(r.from)||t.set(r.from,r)}function Le(e,t){let r=Ce[e][t]?.[0];if(!r)throw new Error(`Could not find a reference move (axis: ${e}, move source type: ${t})`);return r}var xt=(e,t)=>q[e.family].axis===q[t.family].axis;function vt(e,t,r,i){if(t+1===r){let m=Oe[e].get(t);if(m)return new D(new Z(m.family),i*m.direction)}let n=L[e],{sliceDiameter:a}=n;if(t===0&&r===a){let m=Le(e,5);return new D(new Z(m.family),i*m.direction)}let s=t+r>a;s&&([t,r]=[a-r,a-t]);let o=t+1,l=r,u=o===l;u&&(l=null),o===1&&(o=null),u&&o===1&&(l=null),!u&&l===2&&(l=null);let p=Le(e,u?s?1:0:s?3:2);return new D(new Z(p.family,l,o),i*p.direction)}function gt(e,t=!0){if(e.length===0)return[];let r=q[e[0].family].axis,i=L[r],{sliceDiameter:n}=i,a=new Map,s=null;function o(m,S){let d=(a.get(m)??0)+S;t&&(d=d%4+5%4-1),d===0?a.delete(m):a.set(m,d)}let l=0;for(let m of Array.from(e).reverse()){l++;let{moveSourceInfo:S}=q[m.family],d=m.amount*S.direction;switch(S.type){case 0:{let k=(m.innerLayer??1)-1;o(k,d),o(k+1,-d);break}case 1:{let k=n-(m.innerLayer??1);o(k,d),o(k+1,-d);break}case 2:{o((m.outerLayer??1)-1,d),o(m.innerLayer??2,-d);break}case 3:{o(n-(m.innerLayer??2),d),o(n-((m.outerLayer??1)-1),-d);break}case 4:{o(S.from,d),o(S.to,-d);break}case 5:{o(0,d),o(n,-d);break}}[0,2].includes(a.size)&&(s={suffixLength:l,sliceDeltas:new Map(a)})}if(a.size===0)return[];if(!s)return e;let[u,c]=s.sliceDeltas.keys();u>c&&([u,c]=[c,u]);let p=s.sliceDeltas.get(u);return[...e.slice(0,-s.suffixLength),...p!==0?[vt(r,u,c,p)]:[]]}var St={quantumMoveOrder:()=>4,axis:{areQuantumMovesSameAxis:xt,simplifySameAxisMoves:gt}},Ne={id:"3x3x3",fullName:"3\xD73\xD73 Cube",inventedBy:["Ern\u0151 Rubik"],inventionYear:1974,kpuzzle:f(async()=>ue),svg:f(async()=>(await import("./puzzles-dynamic-3x3x3-QN5DUJUA-FBZMHHU2.js")).cube3x3x3SVG),llSVG:f(async()=>(await import("./puzzles-dynamic-3x3x3-QN5DUJUA-FBZMHHU2.js")).cube3x3x3LLSVG),pg:f(async()=>j("3x3x3")),stickeringMask:e=>F(Ne,e),stickerings:()=>H("3x3x3"),puzzleSpecificSimplifyOptions:St},wt={id:"clock",fullName:"Clock",inventedBy:["Christopher C. Wiggs","Christopher J. Taylor"],inventionYear:1988,kpuzzle:f(async()=>new b((await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).clockJSON)),svg:f(async()=>(await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).clockSVG)};async function yt(e,t){let r=await e.kpuzzle(),i=new oe(r),n=new ce(r),a=()=>n.and([n.move("U"),n.not(n.or(n.moves(["F","BL","BR"])))]),s=()=>n.and([n.move("U"),n.not(n.move("F"))]),o=()=>n.or([s(),n.and([n.move("F"),n.not(n.or(n.moves(["U","BL","BR"])))])]),l=()=>n.not(n.or([n.and([n.move("U"),n.move("F")]),n.and([n.move("F"),n.move("BL")]),n.and([n.move("F"),n.move("BR")]),n.and([n.move("BL"),n.move("BR")])])),u=()=>n.not(n.or([n.and([n.move("F"),n.move("BL")]),n.and([n.move("F"),n.move("BR")]),n.and([n.move("BL"),n.move("BR")])]));switch(t){case"full":break;case"experimental-fto-fc":{i.set(n.not(a()),"Ignored");break}case"experimental-fto-f2t":{i.set(n.not(s()),"Ignored"),i.set(a(),"Dim");break}case"experimental-fto-sc":{i.set(n.not(o()),"Ignored"),i.set(s(),"Dim");break}case"experimental-fto-l2c":{i.set(n.not(l()),"Ignored"),i.set(o(),"Dim");break}case"experimental-fto-lbt":{i.set(n.not(u()),"Ignored"),i.set(l(),"Dim");break}case"experimental-fto-l3t":{i.set(u(),"Dim");break}default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),i.set(n.and(n.moves([])),"Dim")}return i.toStickeringMask()}async function bt(){return["full","experimental-fto-fc","experimental-fto-f2t","experimental-fto-sc","experimental-fto-l2c","experimental-fto-lbt","experimental-fto-l3t"]}var zt=class extends E{constructor(){super({pgID:"FTO",id:"fto",fullName:"Face-Turning Octahedron",inventedBy:["Karl Rohrbach","David Pitcher"],inventionYear:1983}),this.stickerings=bt,this.svg=f(async()=>(await import("./puzzles-dynamic-unofficial-QXSDLTK5-FF6NL6H3.js")).ftoSVG)}stickeringMask(e){return yt(this,e)}},Dt=new zt;async function kt(e,t){return(await Me()).includes(t)?F(e,t):(console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),F(e,"full"))}var Et=W(()=>H("megaminx"));function Me(){return Et}var Tt=class extends E{constructor(){super({id:"megaminx",fullName:"Megaminx",inventionYear:1981}),this.stickerings=Me,this.llSVG=f(async()=>(await import("./puzzles-dynamic-megaminx-FUKAIAP5-EI7SA5U5.js")).megaminxLLSVG)}stickeringMask(e){return kt(this,e)}},Rt=new Tt,Pt=class extends E{constructor(){super({id:"pyraminx",fullName:"Pyraminx",inventedBy:["Uwe Meffert"]}),this.svg=f(async()=>(await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).pyraminxSVG)}},Lt=new Pt,It={id:"square1",fullName:"Square-1",inventedBy:["Karel Hr\u0161el","Vojtech Kopsk\xFD"],inventionYear:1990,kpuzzle:f(async()=>new b((await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).sq1HyperOrbitJSON)),svg:f(async()=>(await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).sq1HyperOrbitSVG)},Ct={id:"kilominx",fullName:"Kilominx",kpuzzle:f(async()=>{let e=await j("megaminx + chopasaurus"),t=JSON.parse(JSON.stringify(e.getKPuzzleDefinition(!0)));delete t.orbits.CENTERS,delete t.orbits.CENTERS2,delete t.startStateData.CENTERS,delete t.startStateData.CENTERS2;for(let s of Object.values(t.moves))delete s.CENTERS,delete s.CENTERS2;t.name="kilominx",delete t.experimentalPuzzleDescription;let r=await import("./puzzle-geometry-N6WBCTL4.js"),i=new r.ExperimentalPGNotation(e,e.getOrbitsDef(!0)),n=new b(t,{experimentalPGNotation:{lookupMove:s=>s.toString()==="x2"||s.toString()==="x2'"?a.transformationData:i.lookupMove(s)}}),a=n.algToTransformation("Rv2 Fv Uv'");return t.moves.x2=a,n}),svg:f(async()=>(await import("./puzzles-dynamic-unofficial-QXSDLTK5-FF6NL6H3.js")).kilominxSVG)},Ot={id:"redi_cube",fullName:"Redi Cube",inventedBy:["Oskar van Deventer"],inventionYear:2009,kpuzzle:f(async()=>new b((await import("./puzzles-dynamic-unofficial-QXSDLTK5-FF6NL6H3.js")).rediCubeJSON)),svg:async()=>(await import("./puzzles-dynamic-unofficial-QXSDLTK5-FF6NL6H3.js")).rediCubeSVG},Fe=new A({id:"4x4x4",fullName:"4\xD74\xD74 Cube"});Fe.llSVG=f(async()=>(await import("./puzzles-dynamic-4x4x4-DT42HVIY-DX6TXQV4.js")).cube4x4x4LLSVG);var Nt={id:"melindas2x2x2x2",fullName:"Melinda's 2\xD72\xD72\xD72",inventedBy:["Melinda Green"],kpuzzle:f(async()=>new b((await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).melindas2x2x2x2OrbitJSON)),svg:f(async()=>(await import("./puzzles-dynamic-side-events-FCWYXIA7-J6BYWUHX.js")).melindas2x2x2x2OrbitSVG)},Tn={"3x3x3":Ne,"2x2x2":Ie,"4x4x4":Fe,"5x5x5":new A({id:"5x5x5",fullName:"5\xD75\xD75 Cube"}),"6x6x6":new A({id:"6x6x6",fullName:"6\xD76\xD76 Cube"}),"7x7x7":new A({id:"7x7x7",fullName:"7\xD77\xD77 Cube"}),"40x40x40":new A({id:"40x40x40",fullName:"40\xD740\xD740 Cube"}),clock:wt,megaminx:Rt,pyraminx:Lt,skewb:new E({id:"skewb",fullName:"Skewb",inventedBy:["Tony Durham"]}),square1:It,fto:Dt,gigaminx:new E({id:"gigaminx",fullName:"Gigaminx",inventedBy:["Tyler Fox"],inventionYear:2006}),master_tetraminx:new E({pgID:"master tetraminx",id:"master_tetraminx",fullName:"Master Tetraminx",inventedBy:["Katsuhiko Okamoto"],inventionYear:2002}),kilominx:Ct,redi_cube:Ot,melindas2x2x2x2:Nt};var _={shareAllNewRenderers:"auto",showRenderStats:!1};function On(e){for(let[t,r]of Object.entries(e))t in _&&(_[t]=r)}var Ke=class{#e=0;#t=0;queue(e){return new Promise(async(t,r)=>{try{let i=++this.#e,n=await e;i>this.#t&&(this.#t=i,t(n))}catch(i){r(i)}})}},Ye=0,He=class{constructor(){this.#e=new Set,this.lastSourceGeneration=0,this.#t=new Set,this.#i=!1,this.#r=new Map}canReuse(e,t){return e===t||this.canReuseValue(e,t)}canReuseValue(e,t){return!1}debugGetChildren(){return Array.from(this.#e.values())}#e;addChild(e){this.#e.add(e)}removeChild(e){this.#e.delete(e)}markStale(e){if(e.detail.generation!==Ye)throw new Error("A TwistyProp was marked stale too late!");if(this.lastSourceGeneration!==e.detail.generation){this.lastSourceGeneration=e.detail.generation;for(let t of this.#e)t.markStale(e);this.#n()}}#t;addRawListener(e,t){this.#t.add(e),t?.initial&&e()}removeRawListener(e){this.#t.delete(e)}#n(){this.#i||(this.#i=!0,setTimeout(()=>this.#a(),0))}#i;#a(){if(!this.#i)throw new Error("Invalid dispatch state!");for(let e of this.#t)e();this.#i=!1}#r;addFreshListener(e){let t=new Ke,r=null,i=async()=>{let n=await t.queue(this.get());r!==null&&this.canReuse(r,n)||(r=n,e(n))};this.#r.set(e,i),this.addRawListener(i,{initial:!0})}removeFreshListener(e){this.removeRawListener(this.#r.get(e)),this.#r.delete(e)}},Mt=class extends He{#e;constructor(e){super(),this.#e=W(()=>this.getDefaultValue()),e&&(this.#e=this.deriveFromPromiseOrValue(e,this.#e))}set(e){this.#e=this.deriveFromPromiseOrValue(e,this.#e);let t={sourceProp:this,value:this.#e,generation:++Ye};this.markStale(new CustomEvent("stale",{detail:t}))}async get(){return this.#e}async deriveFromPromiseOrValue(e,t){return this.derive(await e,t)}},Ft=class extends Mt{derive(e){return e}},Nn=Symbol("no value"),Mn=class extends He{constructor(e,t){super(),this.userVisibleErrorTracker=t,this.#e=e;for(let r of Object.values(e))r.addChild(this)}#e;#t=null;#n=null;async get(){let e=this.lastSourceGeneration;if(this.#n?.generation===e)return this.#n.output;let t={generation:e,output:this.#a(this.#i(),e,this.#t)};return this.#n=t,this.userVisibleErrorTracker?.reset(),t.output}async#i(){let e={};for(let[r,i]of Object.entries(this.#e))e[r]=i.get();let t={};for(let r in this.#e)t[r]=await e[r];return t}async#a(e,t,r=null){let i=await e,n=s=>(this.#t={inputs:i,output:Promise.resolve(s),generation:t},s);if(!r)return n(await this.derive(i));let a=r.inputs;for(let s in this.#e)if(!this.#e[s].canReuse(i[s],a[s]))return n(await this.derive(i));return r.output}},Fn=class{#e=[];addListener(e,t){let r=!1,i=n=>{r||t(n)};e.addFreshListener(i),this.#e.push(()=>{e.removeFreshListener(i),r=!0})}addMultiListener3(e,t){this.addMultiListener(e,t)}addMultiListener(e,t){let r=!1,i=e.length-1,n=async a=>{if(i>0){i--;return}if(r)return;let s=e.map(l=>l.get()),o=await Promise.all(s);t(o)};for(let a of e)a.addFreshListener(n);this.#e.push(()=>{for(let a of e)a.removeFreshListener(n);r=!0})}disconnect(){for(let e of this.#e)e()}},We=class{constructor(e){this.callback=e,this.animFrameID=null,this.animFrame=this.animFrameWrapper.bind(this)}requestIsPending(){return!!this.animFrameID}requestAnimFrame(){this.animFrameID||(this.animFrameID=requestAnimationFrame(this.animFrame))}cancelAnimFrame(){this.animFrameID&&(cancelAnimationFrame(this.animFrameID),this.animFrameID=0)}animFrameWrapper(e){this.animFrameID=0,this.callback(e)}},An={floating:!0,none:!0},Gn=class extends Ft{getDefaultValue(){return"auto"}},At=Math.PI*2,ee=360/At,Gt=class{},pe;globalThis.HTMLElement?pe=HTMLElement:pe=Gt;var Bt=class{define(){}},te;globalThis.customElements?te=customElements:te=new Bt;var Ut=class{constructor(e){this.sourceText=e}getAsString(){return this.sourceText}},je=class extends pe{constructor(e){super(),this.#e=new Map,this.shadow=this.attachShadow({mode:e?.mode??"closed"}),this.contentWrapper=document.createElement("div"),this.contentWrapper.classList.add("wrapper"),this.shadow.appendChild(this.contentWrapper)}#e;addCSS(e){let t=this.#e.get(e);if(t)return t;let r=document.createElement("style");return r.textContent=e.getAsString(),this.#e.set(e,r),this.shadow.appendChild(r),r}removeCSS(e){let t=this.#e.get(e);t&&(this.shadow.removeChild(t),this.#e.delete(e))}addElement(e){return this.contentWrapper.appendChild(e)}prependElement(e){this.contentWrapper.prepend(e)}removeElement(e){return this.contentWrapper.removeChild(e)}};te.define("twisty-managed-custom-element",je);var X=globalThis.performance,_t=class{constructor(){this.mode=0,this.dom=document.createElement("div"),this.beginTime=(X||Date).now(),this.prevTime=this.beginTime,this.frames=0,this.fpsPanel=this.addPanel(new de("FPS","#0ff","#002")),this.msPanel=this.addPanel(new de("MS","#0f0","#020")),this.memPanel=X?.memory?this.addPanel(new de("MB","#f08","#201")):null,this.REVISION=16,this.dom.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",this.dom.addEventListener("click",e=>{e.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},!1),this.showPanel(0)}addPanel(e){return this.dom.appendChild(e.dom),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++)this.dom.children[t].style.display=t===e?"block":"none";this.mode=e}begin(){this.beginTime=(X||Date).now()}end(){this.frames++;let e=(X||Date).now();if(this.msPanel.update(e-this.beginTime,200),e>=this.prevTime+1e3&&(this.fpsPanel.update(this.frames*1e3/(e-this.prevTime),100),this.prevTime=e,this.frames=0,this.memPanel)){let t=X.memory;this.memPanel.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e}update(){this.beginTime=this.end()}},g=Math.round(globalThis?.window?.devicePixelRatio??1),me=80*g,Ae=48*g,Ge=3*g,Be=2*g,G=3*g,I=15*g,B=74*g,U=30*g,de=class{constructor(e,t,r){this.name=e,this.fg=t,this.bg=r,this.min=1/0,this.max=0,this.dom=document.createElement("canvas"),this.context=this.dom.getContext("2d"),this.dom.width=me,this.dom.height=Ae,this.dom.style.cssText="width:80px;height:48px",this.context.font=`bold ${9*g}px Helvetica,Arial,sans-serif`,this.context.textBaseline="top",this.context.fillStyle=r,this.context.fillRect(0,0,me,Ae),this.context.fillStyle=t,this.context.fillText(e,Ge,Be),this.context.fillRect(G,I,B,U),this.context.fillStyle=r,this.context.globalAlpha=.9,this.context.fillRect(G,I,B,U)}update(e,t){this.min=Math.min(this.min,e),this.max=Math.max(this.max,e),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,me,I),this.context.fillStyle=this.fg,this.context.fillText(`${Math.round(e)} ${this.name} (${Math.round(this.min)}-${Math.round(this.max)})`,Ge,Be),this.context.drawImage(this.dom,G+g,I,B-g,U,G,I,B-g,U),this.context.fillRect(G+B-g,I,g,U),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(G+B-g,I,g,Math.round((1-e/t)*U))}},Ue=null;async function Vt(){return Ue??(Ue=import("./twisty-dynamic-3d-IAEGMDVR-2UMC7GKI.js"))}var ne=W(async()=>(await Vt()).T3I),Kt=null;function xe(){return Kt??(devicePixelRatio||1)}var Yt=new Ut(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  place-content: center;
  contain: strict;
}

.loading {
  width: 4em;
  height: 4em;
  border-radius: 2.5em;
  border: 0.5em solid rgba(0, 0, 0, 0);
  border-top: 0.5em solid rgba(0, 0, 0, 0.7);
  border-right: 0.5em solid rgba(0, 0, 0, 0.7);
  animation: fade-in-delayed 4s, rotate 1s linear infinite;
}

@keyframes fade-in-delayed {
  0% { opacity: 0; }
  25% {opacity: 0; }
  100% { opacity: 1; }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* TODO: This is due to stats hack. Replace with \`canvas\`. */
.wrapper > canvas {
  max-width: 100%;
  max-height: 100%;
  animation: fade-in 0.25s ease-in;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.wrapper.invisible {
  opacity: 0;
}

.wrapper.drag-input-enabled > canvas {
  cursor: grab;
}

.wrapper.drag-input-enabled > canvas:active {
  cursor: grabbing;
}
`),_e=.1,Ht=class extends EventTarget{constructor(e){super(),this.target=e}#e=new Map;start(){this.addTargetListener("pointerdown",this.onPointerDown.bind(this)),this.addTargetListener("contextmenu",e=>{e.preventDefault()}),this.addTargetListener("touchmove",e=>e.preventDefault()),this.addTargetListener("dblclick",e=>e.preventDefault())}stop(){for(let[e,t]of this.#t.entries())this.target.removeEventListener(e,t);this.#t.clear(),this.#n=!1}#t=new Map;addTargetListener(e,t){this.#t.has(e)||(this.target.addEventListener(e,t),this.#t.set(e,t))}#n=!1;#i(){this.#n||(this.addTargetListener("pointermove",this.onPointerMove.bind(this)),this.addTargetListener("pointerup",this.onPointerUp.bind(this)),this.#n=!0)}#a(e){this.#e.delete(e.pointerId)}#r(e){let t=this.#e.get(e.pointerId);if(!t)return{movementInfo:null,hasMoved:!1};let r;return(e.movementX??0)!==0||(e.movementY??0)!==0?r={attachedInfo:t.attachedInfo,movementX:e.movementX,movementY:e.movementY,elapsedMs:e.timeStamp-t.lastTimeStamp}:r={attachedInfo:t.attachedInfo,movementX:e.clientX-t.lastClientX,movementY:e.clientY-t.lastClientY,elapsedMs:e.timeStamp-t.lastTimeStamp},t.lastClientX=e.clientX,t.lastClientY=e.clientY,t.lastTimeStamp=e.timeStamp,Math.abs(r.movementX)<_e&&Math.abs(r.movementY)<_e?{movementInfo:null,hasMoved:t.hasMoved}:(t.hasMoved=!0,{movementInfo:r,hasMoved:t.hasMoved})}onPointerDown(e){this.#i();let t={attachedInfo:{},hasMoved:!1,lastClientX:e.clientX,lastClientY:e.clientY,lastTimeStamp:e.timeStamp};this.#e.set(e.pointerId,t),this.target.setPointerCapture(e.pointerId)}onPointerMove(e){let t=this.#r(e).movementInfo;t&&(e.preventDefault(),this.dispatchEvent(new CustomEvent("move",{detail:t})))}onPointerUp(e){let t=this.#r(e),r=this.#e.get(e.pointerId);this.#a(e),this.target.releasePointerCapture(e.pointerId);let i;if(t.hasMoved)i=new CustomEvent("up",{detail:{attachedInfo:r.attachedInfo}});else{let{altKey:n,ctrlKey:a,metaKey:s,shiftKey:o}=e;i=new CustomEvent("press",{detail:{normalizedX:e.offsetX/this.target.offsetWidth*2-1,normalizedY:1-e.offsetY/this.target.offsetHeight*2,rightClick:!!(e.button&2),keys:{altKey:n,ctrlOrMetaKey:a||s,shiftKey:o}}})}this.dispatchEvent(i)}},$=[];async function Wt(e,t,r,i){$.length===0&&$.push(ve());let n=await $[0];return n.setSize(e,t),n.render(r,i),n.domElement}async function jt(e,t,r,i,n){if(e===0||t===0)return;$.length===0&&$.push(ve());let a=await Wt(e,t,i,n),s=r.getContext("2d");s.clearRect(0,0,r.width,r.height),s.drawImage(a,0,0)}async function ve(){let e=(await ne).WebGLRenderer,t=new e({antialias:!0,alpha:!0});return t.setPixelRatio(xe()),t}var qt=!0,fe=500,Xt=50,$t=.75;function Ve(e){return(Math.exp(1-e)-(1-e))/(1-Math.E)+1}var Jt=class{constructor(e,t,r,i){this.startTimestamp=e,this.momentumX=t,this.momentumY=r,this.callback=i,this.scheduler=new We(this.render.bind(this)),this.scheduler.requestAnimFrame(),this.lastTimestamp=e}render(e){let t=(this.lastTimestamp-this.startTimestamp)/fe,r=Math.min(1,(e-this.startTimestamp)/fe);if(t===0&&r>Xt/fe)return;let i=Ve(r)-Ve(t);this.callback(this.momentumX*i*1e3,this.momentumY*i*1e3),r<1&&this.scheduler.requestAnimFrame(),this.lastTimestamp=e}},Zt=class{constructor(e,t,r,i){this.model=e,this.mirror=t,this.canvas=r,this.dragTracker=i,this.experimentalInertia=qt,this.onMovementBound=this.onMovement.bind(this),this.experimentalHasBeenMoved=!1,this.dragTracker.addEventListener("move",this.onMove.bind(this)),this.dragTracker.addEventListener("up",this.onUp.bind(this))}temperMovement(e){return Math.sign(e)*Math.log(Math.abs(e*10)+1)/6}onMove(e){var t;(t=e.detail).attachedInfo??(t.attachedInfo={});let{temperedX:r,temperedY:i}=this.onMovement(e.detail.movementX,e.detail.movementY),n=e.detail.attachedInfo;n.lastTemperedX=r*10,n.lastTemperedY=i*10,n.timestamp=e.timeStamp}onMovement(e,t){let r=this.mirror?-1:1,i=Math.min(this.canvas.offsetWidth,this.canvas.offsetHeight),n=this.temperMovement(e/i),a=this.temperMovement(t/i*$t);return this.model.twistySceneModel.orbitCoordinatesRequest.set((async()=>{let s=await this.model.twistySceneModel.orbitCoordinates.get();return{latitude:s.latitude+2*a*ee*r,longitude:s.longitude-2*n*ee}})()),{temperedX:n,temperedY:a}}onUp(e){e.preventDefault(),"lastTemperedX"in e.detail.attachedInfo&&"lastTemperedY"in e.detail.attachedInfo&&"timestamp"in e.detail.attachedInfo&&e.timeStamp-e.detail.attachedInfo.timestamp<60&&new Jt(e.timeStamp,e.detail.attachedInfo.lastTemperedX,e.detail.attachedInfo.lastTemperedY,this.onMovementBound)}};async function Qt(e,t,r=!1){let i=new(await ne).Spherical(t.distance,(90-(r?-1:1)*t.latitude)/ee,((r?180:0)+t.longitude)/ee);i.makeSafe(),e.position.setFromSpherical(i),e.lookAt(0,0,0)}var he=0,en=2,qe=!1;function tn(){return _.shareAllNewRenderers!=="auto"?(_.shareAllNewRenderers||he++,_.shareAllNewRenderers!=="never"):he<en?(he++,!1):(qe=!0,!0)}function Bn(){return qe}var nn=class extends je{constructor(e,t,r){super(),this.model=e,this.options=r,this.scene=null,this.stats=null,this.rendererIsShared=tn(),this.loadingElement=null,this.#t=new Ke,this.#n=0,this.#i=0,this.#r=null,this.#c=null,this.#l=null,this.#u=null,this.#m=null,this.#s=[],this.#o=null,this.#f=new We(this.render.bind(this)),this.scene=t??null,this.loadingElement=this.addElement(document.createElement("div")),this.loadingElement.classList.add("loading"),_.showRenderStats&&(this.stats=new _t,this.stats.dom.style.position="absolute",this.contentWrapper.appendChild(this.stats.dom))}async connectedCallback(){this.addCSS(Yt),this.addElement((await this.canvasInfo()).canvas),this.#a(),new ResizeObserver(this.#a.bind(this)).observe(this.contentWrapper),this.orbitControls(),this.#e(),this.scheduleRender()}async#e(){(await this.#d()).addEventListener("press",async t=>{await this.model.twistySceneModel.movePressInput.get()==="basic"&&this.dispatchEvent(new CustomEvent("press",{detail:{pressInfo:t.detail,cameraPromise:this.camera()}}))})}#t;async clearCanvas(){if(this.rendererIsShared){let e=await this.canvasInfo();e.context.clearRect(0,0,e.canvas.width,e.canvas.height)}else{let t=(await this.renderer()).getContext();t.clear(t.COLOR_BUFFER_BIT)}}#n;#i;async#a(){let e=await this.#t.queue(this.camera()),t=this.contentWrapper.clientWidth,r=this.contentWrapper.clientHeight;this.#n=t,this.#i=r;let i=0,n=0,a=0;if(r>t&&(a=r-t,n=-Math.floor(.5*a)),e.aspect=t/r,e.setViewOffset(t,r-a,i,n,t,r),e.updateProjectionMatrix(),this.clearCanvas(),this.rendererIsShared){let s=await this.canvasInfo();s.canvas.width=t*xe(),s.canvas.height=r*xe(),s.canvas.style.width=`${t.toString()}px`,s.canvas.style.height=`${r.toString()}px`}else(await this.renderer()).setSize(t,r,!0);this.scheduleRender()}#r;async renderer(){if(this.rendererIsShared)throw new Error("renderer expected to be shared.");return this.#r??(this.#r=ve())}#c;async canvasInfo(){return this.#c??(this.#c=(async()=>{let e;if(this.rendererIsShared)e=this.addElement(document.createElement("canvas"));else{let r=await this.renderer();e=this.addElement(r.domElement)}this.loadingElement?.remove();let t=e.getContext("2d");return{canvas:e,context:t}})())}#l;async#d(){return this.#l??(this.#l=(async()=>{let e=new Ht((await this.canvasInfo()).canvas);return this.model?.twistySceneModel.dragInput.addFreshListener(t=>{let r=!1;switch(t){case"auto":{e.start(),r=!0;break}case"none":{e.stop();break}}this.contentWrapper.classList.toggle("drag-input-enabled",r)}),e})())}#u;async camera(){return this.#u??(this.#u=(async()=>{let e=new(await ne).PerspectiveCamera(20,1,.1,20);return e.position.copy(new(await ne).Vector3(2,4,4).multiplyScalar(this.options?.backView?-1:1)),e.lookAt(0,0,0),e})())}#m;async orbitControls(){return this.#m??(this.#m=(async()=>{let e=new Zt(this.model,!!this.options?.backView,(await this.canvasInfo()).canvas,await this.#d());return this.model&&this.addListener(this.model.twistySceneModel.orbitCoordinates,async t=>{let r=await this.camera();Qt(r,t,this.options?.backView),this.scheduleRender()}),e})())}addListener(e,t){e.addFreshListener(t),this.#s.push(()=>{e.removeFreshListener(t)})}#s;disconnect(){for(let e of this.#s)e();this.#s=[]}#o;experimentalNextRenderFinishedCallback(e){this.#o=e}async render(){if(!this.scene)throw new Error("Attempted to render without a scene");this.stats?.begin();let[e,t,r]=await Promise.all([this.scene.scene(),this.camera(),this.canvasInfo()]);this.rendererIsShared?jt(this.#n,this.#i,r.canvas,e,t):(await this.renderer()).render(e,t),this.stats?.end(),this.#o?.(),this.#o=null}#f;scheduleRender(){this.#f.requestAnimFrame()}};te.define("twisty-3d-vantage",nn);export{dn as a,st as b,fn as c,pn as d,Ne as e,Tn as f,On as g,Ke as h,Mt as i,Ft as j,Nn as k,Mn as l,Fn as m,We as n,An as o,Gn as p,At as q,ee as r,pe as s,te as t,Ut as u,je as v,Vt as w,ne as x,Wt as y,Qt as z,Bn as A,nn as B};
//# sourceMappingURL=chunk-CN3ADSZX.js.map
